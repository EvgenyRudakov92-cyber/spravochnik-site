<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ–ª–µ—Ñ–æ–Ω–Ω—ã–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫</title>
    <meta name="theme-color" content="#ff6b00">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #000; min-height: 100vh; }

        .container { max-width: 600px; margin: 0 auto; background: rgba(255,255,255,0.0); border-radius: 20px 20px 0 0; box-shadow: 0 20px 40px rgba(0,0,0,0.3); overflow: hidden; }

        .header { background: linear-gradient(135deg, #ff6b00, #b33939); color: white; padding: 16px 20px; text-align: center; position: relative; }
        .header h1 { font-size: 18px; margin-bottom: 4px; letter-spacing: 1px; }
        .header p { font-size: 12px; opacity: 0.9; }

        .back-btn {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            width: 44px;
            height: 44px;
            border-radius: 50%;
            border: 2px solid #ffffff;
            background: linear-gradient(135deg,#ff7a00,#ff3b00);
            color: #fff;
            font-size: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .search-box { padding: 16px 20px; background: transparent; }
        .search-input { width: 100%; padding: 10px 16px; font-size: 15px; border: 2px solid #e1e5e9; border-radius: 30px; outline: none; transition: all 0.3s; }
        .search-input:focus { border-color: #ff6b00; box-shadow: 0 0 0 3px rgba(255,107,0,0.15); }

        .list { padding: 0 12px 12px; max-height: 40vh; overflow-y: auto; background:transparent; }
        .no-results { text-align: center; padding: 20px 12px; color: #f1f2f6; font-size: 15px; }

        /* –ö–ê–†–¢–û–ß–ö–ê */
        .card {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #000000;
            border-radius: 30px;
            padding: 18px 20px;
            margin: 12px 0;
            box-shadow: 0 0 0 1px rgba(255,255,255,0.08),
                        0 16px 40px rgba(0,0,0,0.9);
            color: #ffffff;
            overflow: hidden;
        }
        .card.premium-top {
            background: linear-gradient(135deg, #1a1a1a, #ff6b00);
            border: 2px solid gold;
        }
        .card.premium-highlight {
            background: linear-gradient(135deg, #003300, #00cc00);
            border: 2px solid #00ff00;
        }
        .card.premium-verified {
            background: linear-gradient(135deg, #000033, #0066ff);
            border: 2px solid #0066ff;
            position: relative;
        }
        .card.premium-verified::after {
            content: "‚úÖ –í–ï–†–ò–§–ò–¶–ò–†–û–í–ê–ù–û";
            position: absolute;
            top: 10px;
            right: 10px;
            background: #0066ff;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: bold;
        }
        .card.premium-urgent {
            background: linear-gradient(135deg, #330000, #ff0000);
            border: 2px solid #ff4444;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 0, 0, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 0, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 0, 0, 0); }
        }
        .card::before {
            content: "";
            position: absolute;
            inset: -40%;
            background: radial-gradient(circle at center, rgba(255,120,0,0.9), transparent 60%);
            opacity: 0.8;
            z-index: 0;
        }
        .card-content {
            position: relative;
            z-index: 1;
            max-width: 65%;
        }
        .card-title-main {
            font-size: 22px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 4px;
        }
        .card-title-sub {
            font-size: 16px;
            font-weight: 500;
            font-style: italic;
            margin-bottom: 6px;
        }
        .card-city {
            font-size: 13px;
            letter-spacing: 1px;
            margin-bottom: 4px;
            opacity: 0.9;
        }
        .card-phone {
            font-size: 14px;
            font-weight: 700;
        }

        .card-actions {
            position: relative;
            z-index: 1;
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 12px;
        }
        .btn-circle {
            width: 72px;
            height: 72px;
            border-radius: 50%;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 26px rgba(0,0,0,0.8);
            cursor: pointer;
            transition: transform 0.15s ease, box-shadow 0.15s ease;
            text-decoration: none;
        }
        .btn-circle span {
            font-size: 34px;
            color: #ffffff;
        }
        .btn-call-circle {
            background: radial-gradient(circle at 30% 30%, #7fff5a, #00a826);
        }
        .btn-site-circle {
            background: radial-gradient(circle at 30% 30%, #7fd4ff, #005bb5);
        }
        .btn-circle:active {
            transform: scale(0.94);
            box-shadow: 0 6px 16px rgba(0,0,0,0.9);
        }

        /* –ö–ù–û–ü–ö–ò –í –°–¢–ò–õ–ï ¬´–î–ê–õ–ï–ï¬ª */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 10px 22px;
            border-radius: 25px;
            border: 2px solid #ffffff;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            text-decoration: none;
            background: linear-gradient(135deg,#ff7a00,#ff3b00);
            color: #ffffff;
            box-shadow: 0 6px 18px rgba(0,0,0,0.45);
            transition: transform 0.15s ease, box-shadow 0.15s ease, opacity 0.15s ease;
        }
        .btn:hover {
            box-shadow: 0 8px 22px rgba(0,0,0,0.6);
            transform: translateY(-1px);
        }
        .btn:active {
            transform: translateY(1px) scale(0.97);
            box-shadow: 0 3px 10px rgba(0,0,0,0.7);
        }
        .btn-primary,
        .btn-success,
        .btn-feedback {
            background: linear-gradient(135deg,#ff7a00,#ff3b00);
            color:#ffffff;
        }
        .btn-premium {
            background: linear-gradient(135deg, #ffd700, #ff9500);
            color: #000;
            font-weight: bold;
            border: 2px solid #ffd700;
            font-size: 12px;
            padding: 6px 12px;
        }
        .btn-premium:hover {
            background: linear-gradient(135deg, #ffed4e, #ffaa00);
            transform: translateY(-2px);
        }

        /* –†—è–¥ –∫–Ω–æ–ø–æ–∫ —Å–Ω–∏–∑—É */
        .buttons-row {
            display: flex;
            justify-content: space-between;
            gap: 8px;
        }
        .buttons-row .btn {
            flex: 1 1 0;
            padding: 10px 8px;
            font-size: 13px;
        }

        .btn-danger { background: #e17055; color: white; }
        .btn-danger:hover { background: #d63031; }

        .screen { display: none; }
        .screen.active { display: block; }

        #adminScreen input, #adminScreen textarea,
        #profileScreen input, #profileScreen textarea,
        #feedbackScreen textarea {
            width: 100%; padding: 10px; margin-bottom: 10px;
            border: 2px solid #e1e5e9; border-radius: 8px; font-size: 14px;
        }
        #adminScreen input:focus, #profileScreen input:focus, #feedbackScreen textarea:focus {
            border-color: #ff6b00; outline: none;
        }
        .admin-item { background: #f8f9fa; border-radius: 8px; padding: 10px; margin-bottom: 8px; font-size: 13px; }
        .status-active { color: #27ae60; font-weight: bold; }
        .status-expired { color: #e74c3c; font-weight: bold; }
        .days-select { background:#f8f9fa; padding:8px; border-radius:8px; margin-bottom:10px; font-size:13px; }
        .city-suggestions {
            position:absolute;
            top:100%;
            left:50%;
            transform:translateX(-50%);
            width:100%;
            max-width:420px;
            background:rgba(0,0,0,0.85);
            color:#fff;
            border-radius:8px;
            margin-top:6px;
            max-height:140px;
            overflow-y:auto;
            font-size:14px;
            z-index:3;
        }
        .city-suggestion-item{
            padding:8px 12px;
            border-bottom:1px solid rgba(255,255,255,0.1);
            cursor:pointer;
        }
        .city-suggestion-item:hover{
            background:rgba(255,255,255,0.08);
        }

        .category-big{
            width:100%;
            margin:6px 0;
            padding:10px 8px;
            border-radius:28px;
            border:2px solid #ffffff;
            background:linear-gradient(135deg,#000000,#ff7a00);
            color:#ffffff;
            font-size:18px;
            font-weight:800;
            text-align:center;
            cursor:pointer;
            box-shadow:0 6px 14px rgba(0,0,0,0.5);
        }
        .category-big:active{
            transform:scale(0.97);
        }

        .category-pill{
            display:flex;
            align-items:center;
            justify-content:space-between;
            padding:6px 10px;
            margin-bottom:6px;
            border-radius:16px;
            background:#f1f2f6;
            font-size:13px;
        }
        .category-pill span{
            flex:1;
        }

        /* –ê–∫–∫–æ—Ä–¥–µ–æ–Ω –≤ –∞–¥–º–∏–Ω–∫–µ */
        .admin-section { margin-bottom: 10px; }
        .admin-section-title {
            width:100%;
            text-align:left;
            padding:10px 12px;
            border-radius:10px;
            border:2px solid #ff7a00;
            background:linear-gradient(135deg,#000000,#ff7a00);
            color:#ffffff;
            font-size:14px;
            font-weight:700;
            cursor:pointer;
            margin-bottom:4px;
        }
        .admin-section-body {
            border-radius:10px;
            background:#f8f9fa;
            padding:10px;
            display:none;
        }
        .admin-section-body.active { display:block; }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ–ø–ª–∞—Ç—ã */
        .payment-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            padding: 20px;
        }
        .payment-content {
            background: white;
            border-radius: 15px;
            padding: 25px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }
        .payment-method {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s;
        }
        .payment-method:hover {
            border-color: #ff6b00;
            background: #fff;
        }
        .payment-method.selected {
            border-color: #ff6b00;
            background: #fff8e1;
        }
        .qr-code {
            text-align: center;
            padding: 20px;
            background: white;
            border-radius: 10px;
            margin: 15px 0;
        }
        .premium-badge {
            display: inline-block;
            background: gold;
            color: #000;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            margin-left: 5px;
        }
    </style>
</head>
<body>

    <!-- –ü–ï–†–í–´–ô –≠–ö–†–ê–ù -->
    <div id="startScreen" class="screen active" style="max-width:600px;margin:0 auto;overflow:hidden;">
        <div style="
            position:relative;
            height:100vh;
            max-height:800px;
            background:#000;
            padding:20px 20px 100px 20px;
            display:flex;
            flex-direction:column;
            align-items:center;
        ">
            <div style="
                flex:1;
                width:100%;
                display:flex;
                flex-direction:column;
                align-items:center;
            ">
                <div style="
                    flex:1;
                    width:100%;
                    display:flex;
                    justify-content:center;
                    align-items:center;
                ">
                    <img src="IKONKA.png"
                         alt="–¢–µ–ª–µ—Ñ–æ–Ω–Ω—ã–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫"
                         style="width:70%; max-width:260px; border-radius:24px; box-shadow:0 10px 30px rgba(0,0,0,0.6);">
                </div>

                <div style="width:100%; max-width:420px; margin-bottom:40px; position:relative;">
                    <input id="startCityInput"
                           type="text"
                           placeholder="–ü–æ–∏—Å–∫ –ø–æ –≥–æ—Ä–æ–¥—É..."
                           autocomplete="off"
                           oninput="updateCitySuggestions()"
                           style="
                               width:100%;
                               padding:14px 18px;
                               border-radius:8px;
                               border:2px solid #ffffff;
                               background:rgba(0,0,0,0.75);
                               color:#ffffff;
                               font-size:16px;
                               outline:none;
                           ">
                    <div id="citySuggestions" class="city-suggestions" style="display:none;"></div>
                </div>
            </div>

            <button onclick="startNext()" 
                    style="
                        position:absolute;
                        bottom:40px;
                        right:40px;
                        padding:12px 30px;
                        border-radius:25px;
                        border:2px solid #ffffff;
                        background:linear-gradient(135deg,#ff7a00,#ff3b00);
                        color:#ffffff;
                        font-size:18px;
                        font-weight:bold;
                        cursor:pointer;
                        box-shadow:0 6px 18px rgba(0,0,0,0.4);
                    ">
                –î–∞–ª–µ–µ
            </button>
        </div>
    </div>

    <!-- –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ô–ù–ï–† -->
    <div class="container">

        <!-- –ì–õ–ê–í–ù–´–ô –≠–ö–†–ê–ù –° –ö–ê–¢–ï–ì–û–†–ò–Ø–ú–ò -->
        <div id="mainScreen" class="screen">
            <div class="header" style="background:linear-gradient(135deg,#ff7a00,#ff3b00);">
                <button class="back-btn" onclick="goBackToStart()">‚Üê</button>
                <h1 style="font-size:20px;">–¢–ï–õ–ï–§–û–ù–´</h1>
                <p id="currentCityTitle">–≥. –£—Å—Ç—å-–ö–∞—Ç–∞–≤</p>
            </div>

            <div style="
                background:#000;
                min-height:100vh;
                padding:16px 12px 24px;
            ">
                <div id="categoryButtons" style="max-height:50vh; overflow-y:auto; padding-right:4px;">
                    <!-- –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–∑ JS -->
                </div>

                <div style="margin-top:16px; background:rgba(0,0,0,0.7); padding:12px; border-radius:16px;">
                    <div class="search-box" style="padding:0 0 8px 0;">
                        <input type="text" id="searchInput" class="search-input" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É –≥–æ—Ä–æ–¥—É...">
                    </div>
                    <div class="list" id="mainListContainer"></div>
                    <div style="padding-top:10px;">
                        <div class="buttons-row">
                            <button class="btn btn-primary" onclick="showProfileScreen()">‚ûï –î–æ–±–∞–≤–∏—Ç—å —É—Å–ª—É–≥—É</button>
                            <button class="btn btn-success" onclick="openAdmin()">üõ† –ê–¥–º–∏–Ω</button>
                            <button class="btn btn-feedback" onclick="showFeedbackScreen()">üí¨ –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –≠–ö–†–ê–ù –ö–ê–¢–ï–ì–û–†–ò–ò -->
        <div id="categoryScreen" class="screen">
            <div class="header" style="background:linear-gradient(135deg,#ff7a00,#ff3b00);">
                <button class="back-btn" onclick="showMainScreen()">‚Üê</button>
                <h1 id="categoryTitle" style="font-size:20px;">–ö–ê–¢–ï–ì–û–†–ò–Ø</h1>
                <p>–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫</p>
            </div>

            <div style="
                background:#000;
                min-height:100vh;
                padding:16px 12px 24px;
            ">
                <div class="search-box" style="padding:0 0 16px;">
                    <input type="text" id="categorySearchInput" class="search-input" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏...">
                </div>
                <div class="list" id="categoryListContainer">
                    <div class="no-results">–ù–µ—Ç —É—Å–ª—É–≥ –≤ —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</div>
                </div>
            </div>
        </div>

        <!-- –î–û–ë–ê–í–õ–ï–ù–ò–ï –£–°–õ–£–ì–ò -->
        <div id="profileScreen" class="screen">
            <div class="header">
                <button class="back-btn" onclick="showMainScreen()">‚Üê</button>
                <h1>–î–æ–±–∞–≤–∏—Ç—å —É—Å–ª—É–≥—É</h1>
                <p>–ü—É–±–ª–∏–∫–∞—Ü–∏—è –Ω–∞ 30 –¥–Ω–µ–π</p>
            </div>
            <div style="padding: 20px; background:#fff;">
                <input type="text" id="profName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ (–≤–∞—à–µ –∏–º—è –∏–ª–∏ —Ñ–∏—Ä–º–∞)">
                <select id="profCategory" style="width:100%; padding:10px; margin-bottom:10px; border:2px solid #e1e5e9; border-radius:8px;">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                </select>
                <input type="text" id="profCity" placeholder="–ì–æ—Ä–æ–¥">
                <input type="tel" id="profPhone" placeholder="üìû –¢–µ–ª–µ—Ñ–æ–Ω (8-9xx-xxx-xx-xx)">
                <input type="url" id="profSite" placeholder="üåê –°–∞–π—Ç –∏–ª–∏ —Å–æ—Ü—Å–µ—Ç—å (https://...)">
                <textarea id="profDescription" rows="3" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ (–∫–æ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç–µ, –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏...)"></textarea>
                <button class="btn btn-primary" style="width:100%; padding:12px; font-size:15px;" onclick="profileNext()">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å (30 –¥–Ω–µ–π)</button>
            </div>
        </div>

        <!-- –ê–î–ú–ò–ù–ö–ê -->
        <div id="adminScreen" class="screen">
            <div class="header">
                <button class="back-btn" onclick="showMainScreen()">‚Üê</button>
                <h1>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h1>
                <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Å–ª—É–≥–∞–º–∏</p>
            </div>
            <div style="padding: 20px; background:#fff;">

                <!-- –í–•–û–î –ê–î–ú–ò–ù–ê -->
                <div id="adminPassword" style="text-align:center; padding:20px;">
                    <input type="text" id="adminLogin" placeholder="–õ–æ–≥–∏–Ω" style="width:200px; padding:10px; font-size:14px; text-align:center; margin-bottom:8px;"><br>
                    <input type="password" id="adminPassInput" placeholder="–ü–∞—Ä–æ–ª—å" style="width:200px; padding:10px; font-size:14px; text-align:center;"><br><br>
                    <button class="btn btn-primary" onclick="checkAdmin()">–í–æ–π—Ç–∏</button>
                </div>

                <div id="adminContent" style="display:none;">

                    <!-- –ü–ê–ü–ö–ê: –ö–ê–¢–ï–ì–û–†–ò–ò (–¢–û–õ–¨–ö–û –î–õ–Ø –°–£–ü–ï–†-–ê–î–ú–ò–ù–ê) -->
                    <div id="adminCategoriesBlock" class="admin-section">
                        <button class="admin-section-title" onclick="toggleAdminSection('cats')">üóÇ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏</button>
                        <div class="admin-section-body" id="adminSection-cats">
                            <div style="margin-bottom:8px;">
                                <input type="text" id="newCategoryName" placeholder="–ù–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è">
                                <button class="btn btn-success" style="width:100%; margin-top:6px;" onclick="addCategory()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</button>
                            </div>
                            <div id="adminCategoriesList" style="margin-bottom:4px;"></div>
                        </div>
                    </div>

                    <!-- –ü–ê–ü–ö–ê: –°–û–ó–î–ê–ù–ò–ï –£–°–õ–£–ì (–° –ü–û–ò–°–ö–û–ú) -->
                    <div class="admin-section">
                        <button class="admin-section-title" onclick="toggleAdminSection('services')">üìù –°–æ–∑–¥–∞–Ω–∏–µ —É—Å–ª—É–≥</button>
                        <div class="admin-section-body" id="adminSection-services">
                            <input type="text" id="adminName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
                            <select id="adminCategory" style="width:100%; padding:10px; margin-bottom:10px; border:2px solid #e1e5e9; border-radius:8px;">
                                <option value="">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</option>
                            </select>
                            <input type="text" id="adminCity" placeholder="–ì–æ—Ä–æ–¥">
                            <input type="tel" id="adminPhone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω">
                            <input type="url" id="adminSite" placeholder="–°–∞–π—Ç">
                            <textarea id="adminDescription" rows="2" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ"></textarea>

                            <div class="days-select">
                                <label style="display:block; margin-bottom:4px; font-weight:bold;">üìÖ –°—Ä–æ–∫ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏:</label>
                                <select id="adminDays" style="width:100%; padding:8px; border:2px solid #e1e5e9; border-radius:8px; font-size:14px;">
                                    <option value="7">7 –¥–Ω–µ–π (—Ç–µ—Å—Ç)</option>
                                    <option value="30" selected>30 –¥–Ω–µ–π (—Å—Ç–∞–Ω–¥–∞—Ä—Ç)</option>
                                    <option value="90">90 –¥–Ω–µ–π (3 –º–µ—Å—è—Ü–∞)</option>
                                    <option value="365">365 –¥–Ω–µ–π (–≥–æ–¥)</option>
                                    <option value="0">–ë–µ—Å—Å—Ä–æ—á–Ω–æ (–∞–¥–º–∏–Ω)</option>
                                </select>
                            </div>
                            <button class="btn btn-success" style="width:100%; margin-bottom:10px;" onclick="createAdminService()">‚ûï –°–æ–∑–¥–∞—Ç—å —É—Å–ª—É–≥—É</button>
                            
                            <!-- –ü–û–ò–°–ö –í –ê–î–ú–ò–ù–ö–ï -->
                            <div style="background:rgba(248,249,250,0.5); padding:12px; border-radius:8px; margin-bottom:10px;">
                                <input type="text" id="adminSearchInput" class="search-input" 
                                       placeholder="üîç –ü–æ–∏—Å–∫ —É—Å–ª—É–≥ (–∏–º—è, –∫–∞—Ç–µ–≥–æ—Ä–∏—è, –≥–æ—Ä–æ–¥, —Ç–µ–ª–µ—Ñ–æ–Ω, –æ–ø–∏—Å–∞–Ω–∏–µ...)" 
                                       style="width:100%; padding:10px 16px; font-size:14px; border:2px solid #e1e5e9; border-radius:20px;"
                                       oninput="filterAdminList()">
                            </div>
                            
                            <h3 style="margin-bottom:6px; color:#2c3e50; font-size:15px;">üìã –í—Å–µ —É—Å–ª—É–≥–∏</h3>
                            <div id="adminList" style="max-height:300px; overflow-y:auto;"></div>
                        </div>
                    </div>

                    <!-- –ü–ê–ü–ö–ê: –ü–õ–ê–¢–ï–ñ–ò –ò –ü–†–ï–ú–ò–£–ú -->
                    <div class="admin-section">
                        <button class="admin-section-title" onclick="toggleAdminSection('payments')">üí∞ –ü–ª–∞—Ç–µ–∂–∏ –∏ –ü—Ä–µ–º–∏—É–º</button>
                        <div class="admin-section-body" id="adminSection-payments">
                            <div style="margin-bottom: 15px; padding: 10px; background: #f1f8e9; border-radius: 8px;">
                                <h4 style="margin: 0 0 10px 0; color: #2e7d32;">üí∞ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π</h4>
                                <div id="paymentStats">
                                    <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...</p>
                                </div>
                            </div>
                            
                            <div style="margin-bottom: 15px;">
                                <h4 style="margin: 0 0 10px 0; color: #2c3e50;">üí≥ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞–º–∏</h4>
                                <div id="paymentsList" style="max-height: 300px; overflow-y: auto; margin-bottom: 10px;"></div>
                                <div style="display: flex; gap: 10px;">
                                    <button class="btn btn-primary" onclick="loadPayments()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
                                    <button class="btn btn-success" onclick="exportPaymentsToCSV()">üì• –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV</button>
                                    <button class="btn btn-danger" onclick="clearCompletedPayments()">üßπ –û—á–∏—Å—Ç–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ</button>
                                </div>
                            </div>
                            
                            <div style="margin-bottom: 15px;">
                                <h4 style="margin: 0 0 10px 0; color: #2c3e50;">üöÄ –ê–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–µ–º–∏—É–º-—É—Å–ª—É–≥–∏</h4>
                                <div id="activePremiums" style="max-height: 200px; overflow-y: auto;"></div>
                            </div>
                            
                            <div style="padding: 15px; background: #fff3e0; border-radius: 8px;">
                                <h4 style="margin: 0 0 10px 0; color: #e65100;">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ü–µ–Ω</h4>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                    <div>
                                        <label style="display: block; font-size: 12px; color: #666;">–í —Ç–æ–ø–µ (7 –¥–Ω–µ–π)</label>
                                        <input type="number" id="priceTop" value="100" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    </div>
                                    <div>
                                        <label style="display: block; font-size: 12px; color: #666;">–í—ã–¥–µ–ª–µ–Ω–∏–µ (7 –¥–Ω–µ–π)</label>
                                        <input type="number" id="priceHighlight" value="50" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    </div>
                                    <div>
                                        <label style="display: block; font-size: 12px; color: #666;">–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è (30 –¥–Ω–µ–π)</label>
                                        <input type="number" id="priceVerified" value="300" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    </div>
                                    <div>
                                        <label style="display: block; font-size:12px; color: #666;">–°—Ä–æ—á–Ω–æ (3 –¥–Ω—è)</label>
                                        <input type="number" id="priceUrgent" value="150" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    </div>
                                </div>
                                <button class="btn btn-success" style="width: 100%; margin-top: 10px;" onclick="savePricing()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ü–µ–Ω—ã</button>
                            </div>
                        </div>
                    </div>

                    <!-- –ü–ê–ü–ö–ê: –û–¢–ó–´–í–´/–ü–†–ï–î–õ–û–ñ–ï–ù–ò–Ø -->
                    <div class="admin-section">
                        <button class="admin-section-title" onclick="toggleAdminSection('feedback')">üì® –ñ–∞–ª–æ–±—ã –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è</button>
                        <div class="admin-section-body" id="adminSection-feedback">
                            <div id="adminFeedbackList"></div>
                        </div>
                    </div>

                    <!-- –ü–ê–ü–ö–ê: –ß–ê–¢ –ê–î–ú–ò–ù–û–í -->
                    <div class="admin-section">
                        <button class="admin-section-title" onclick="toggleAdminSection('chat')">üí¨ –ß–∞—Ç –∞–¥–º–∏–Ω–æ–≤</button>
                        <div class="admin-section-body" id="adminSection-chat">
                            <div id="adminChatMessages" style="max-height:200px; overflow-y:auto; margin-bottom:8px;"></div>
                            <textarea id="adminChatInput" rows="2" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –¥—Ä—É–≥–∏—Ö –∞–¥–º–∏–Ω–æ–≤..."></textarea>
                            <button class="btn btn-primary" style="width:100%;" onclick="sendAdminChat()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <!-- –û–ë–†–ê–¢–ù–ê–Ø –°–í–Ø–ó–¨ -->
        <div id="feedbackScreen" class="screen">
            <div class="header">
                <button class="back-btn" onclick="showMainScreen()">‚Üê</button>
                <h1>–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å</h1>
            </div>
            <div style="padding: 20px; background:#fff;">
                <textarea id="feedbackText" rows="5" placeholder="–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é –∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ..."></textarea>
                <input type="tel" id="feedbackPhone" placeholder="üìû –í–∞—à —Ç–µ–ª–µ—Ñ–æ–Ω (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)">
                <button class="btn btn-feedback" style="width:100%; padding:12px;" onclick="sendFeedback()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            </div>
        </div>

    </div>

    <!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –û–ü–õ–ê–¢–´ -->
    <div id="paymentModal" class="payment-modal" style="display: none;">
        <div class="payment-content">
            <h2 style="color: #ff6b00; margin-bottom: 20px;" id="paymentTitle">–û–ø–ª–∞—Ç–∞ –ø—Ä–µ–º–∏—É–º-—Å—Ç–∞—Ç—É—Å–∞</h2>
            <div id="paymentDetails"></div>
            <div id="paymentMethods">
                <h4 style="margin: 20px 0 10px 0;">–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã:</h4>
                <div class="payment-method" onclick="selectPaymentMethod('sber')">
                    <strong>üí≥ –°–±–µ—Ä–±–∞–Ω–∫ Online</strong>
                    <p style="margin: 5px 0 0 0; font-size: 12px; color: #666;">–ü–µ—Ä–µ–≤–æ–¥ –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞</p>
                </div>
                <div class="payment-method" onclick="selectPaymentMethod('tinkoff')">
                    <strong>üì± –¢–∏–Ω—å–∫–æ—Ñ—Ñ</strong>
                    <p style="margin: 5px 0 0 0; font-size: 12px; color: #666;">–û–ø–ª–∞—Ç–∞ –ø–æ QR-–∫–æ–¥—É</p>
                </div>
                <div class="payment-method" onclick="selectPaymentMethod('cash')">
                    <strong>üí∞ –ù–∞–ª–∏—á–Ω—ã–µ –∫—É—Ä—å–µ—Ä—É</strong>
                    <p style="margin: 5px 0 0 0; font-size: 12px; color: #666;">–û–ø–ª–∞—Ç–∞ –ø—Ä–∏ –≤—Å—Ç—Ä–µ—á–µ</p>
                </div>
            </div>
            <div id="paymentInstructions" style="display: none; margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 10px;"></div>
            <div style="margin-top: 20px; display: flex; gap: 10px;">
                <button class="btn btn-primary" onclick="processPayment()" id="payButton" style="flex: 2;">‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –æ–ø–ª–∞—Ç—É</button>
                <button class="btn btn-danger" onclick="closePaymentModal()" style="flex: 1;">‚ùå –û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <script>
        // ================ –û–°–ù–û–í–ù–´–ï –î–ê–ù–ù–´–ï ================
        let data = [];
        let currentCity = '–£—Å—Ç—å-–ö–∞—Ç–∞–≤';
        let adminMode = false;
        let feedbackData = [];
        let currentCategoryForSearch = 'all';
        let adminSearchTerm = '';
        let admins = [];
        let currentAdmin = null;
        let categories = [];
        let adminChat = [];
        
        // ================ –°–ò–°–¢–ï–ú–ê –ú–û–ù–ï–¢–ò–ó–ê–¶–ò–ò ================
        let premiumServices = {};
        let paymentsLog = [];
        let currentPayment = null;
        let selectedPaymentMethod = null;
        
        // –¶–µ–Ω—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        let PRICING = {
            TOP_7_DAYS: 100,
            HIGHLIGHT_7_DAYS: 50,
            VERIFIED_30_DAYS: 300,
            URGENT_3_DAYS: 150
        };
        
        const defaultCategories = [
            '–¢–∞–∫—Å–∏',
            '–°–∞–Ω—Ç–µ—Ö–Ω–∏–∫',
            '–≠–ª–µ–∫—Ç—Ä–∏–∫',
            '–ê—Ä—Ç–∏—Å—Ç—ã',
            '–ì—Ä—É–∑–æ–ø–µ—Ä–µ–≤–æ–∑–∫–∏',
            '–Æ—Ä–∏—Å—Ç',
            'IT —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç',
            '–ê–≤—Ç–æ—Ä–µ–º–æ–Ω—Ç',
            '–ü–∏–ª–æ—Ä–∞–º–∞',
            '–¢–æ–≤–∞—Ä—ã –æ—Ç –º–µ—Å—Ç–Ω—ã—Ö'
        ];
        
        const cities = [
            '–£—Å—Ç—å-–ö–∞—Ç–∞–≤','–Æ—Ä—é–∑–∞–Ω—å','–ö–∞—Ç–∞–≤-–ò–≤–∞–Ω–æ–≤—Å–∫','–¢—Ä—ë—Ö–≥–æ—Ä–Ω—ã–π','–ê—à–∞',
            '–°–∏–º','–ú–∏–∞—Å—Å','–ó–ª–∞—Ç–æ—É—Å—Ç','–ß–µ–ª—è–±–∏–Ω—Å–∫','–£—Ñ–∞','–ú–∞–≥–Ω–∏—Ç–æ–≥–æ—Ä—Å–∫','–ö—ã—à—Ç—ã–º'
        ];
        
        // ================ –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ================
        document.addEventListener('DOMContentLoaded', function() {
            loadAdmins();
            loadCategories();
            loadPricing();
            loadPayments();
            loadPremiumServices();
            renderCategoryButtons();
            renderCategorySelects();
            loadData();
            loadFeedback();
            loadAdminChat();
            setupSearch();
            updatePaymentStats();
        });
        
        // ================ –°–ò–°–¢–ï–ú–ê –¶–ï–ù ================
        function loadPricing() {
            const saved = localStorage.getItem('ustKatavPricing');
            if (saved) {
                PRICING = JSON.parse(saved);
            }
            updatePricingInputs();
        }
        
        function savePricing() {
            PRICING = {
                TOP_7_DAYS: parseInt(document.getElementById('priceTop').value) || 100,
                HIGHLIGHT_7_DAYS: parseInt(document.getElementById('priceHighlight').value) || 50,
                VERIFIED_30_DAYS: parseInt(document.getElementById('priceVerified').value) || 300,
                URGENT_3_DAYS: parseInt(document.getElementById('priceUrgent').value) || 150
            };
            localStorage.setItem('ustKatavPricing', JSON.stringify(PRICING));
            alert('‚úÖ –¶–µ–Ω—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
        }
        
        function updatePricingInputs() {
            if (document.getElementById('priceTop')) {
                document.getElementById('priceTop').value = PRICING.TOP_7_DAYS;
                document.getElementById('priceHighlight').value = PRICING.HIGHLIGHT_7_DAYS;
                document.getElementById('priceVerified').value = PRICING.VERIFIED_30_DAYS;
                document.getElementById('priceUrgent').value = PRICING.URGENT_3_DAYS;
            }
        }
        
        // ================ –ü–†–ï–ú–ò–£–ú –°–ò–°–¢–ï–ú–ê ================
        function loadPremiumServices() {
            const saved = localStorage.getItem('ustKatavPremium');
            premiumServices = saved ? JSON.parse(saved) : {};
        }
        
        function savePremiumServices() {
            localStorage.setItem('ustKatavPremium', JSON.stringify(premiumServices));
        }
        
        function isPremiumActive(serviceId, type) {
            const premium = premiumServices[serviceId];
            if (!premium) return false;
            
            const now = Date.now();
            return premium[type] && premium[type] > now;
        }
        
        function getPremiumClass(serviceId) {
            if (isPremiumActive(serviceId, 'TOP_7_DAYS')) return 'premium-top';
            if (isPremiumActive(serviceId, 'HIGHLIGHT_7_DAYS')) return 'premium-highlight';
            if (isPremiumActive(serviceId, 'VERIFIED_30_DAYS')) return 'premium-verified';
            if (isPremiumActive(serviceId, 'URGENT_3_DAYS')) return 'premium-urgent';
            return '';
        }
        
        // ================ –ü–õ–ê–¢–ï–ñ–ò ================
        function loadPayments() {
            const saved = localStorage.getItem('ustKatavPayments');
            paymentsLog = saved ? JSON.parse(saved) : [];
            renderPaymentsList();
        }
        
        function savePayments() {
            localStorage.setItem('ustKatavPayments', JSON.stringify(paymentsLog));
        }
        
        // ================ –û–ü–õ–ê–¢–ê ================
        function showPremiumOptions(serviceId, serviceName) {
            currentPayment = {
                serviceId,
                serviceName,
                date: new Date().toISOString(),
                orderId: 'ORD' + Date.now() + Math.random().toString(36).substr(2, 6).toUpperCase()
            };
            
            document.getElementById('paymentTitle').textContent = `–û–ø–ª–∞—Ç–∞ –¥–ª—è: ${serviceName}`;
            document.getElementById('paymentDetails').innerHTML = `
                <div style="background: #f0f8ff; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                    <h4 style="margin: 0 0 10px 0; color: #0066cc;">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–º–∏—É–º-—Å—Ç–∞—Ç—É—Å:</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <button class="btn-premium" onclick="selectPremiumType('TOP_7_DAYS')" 
                                style="width: 100%; text-align: left; padding: 10px;">
                            üöÄ –í —Ç–æ–ø–µ –Ω–∞ 7 –¥–Ω–µ–π<br>
                            <strong>${PRICING.TOP_7_DAYS}‚ÇΩ</strong>
                        </button>
                        <button class="btn-premium" onclick="selectPremiumType('HIGHLIGHT_7_DAYS')" 
                                style="width: 100%; text-align: left; padding: 10px;">
                            üé® –í—ã–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ 7 –¥–Ω–µ–π<br>
                            <strong>${PRICING.HIGHLIGHT_7_DAYS}‚ÇΩ</strong>
                        </button>
                        <button class="btn-premium" onclick="selectPremiumType('VERIFIED_30_DAYS')" 
                                style="width: 100%; text-align: left; padding: 10px;">
                            ‚úÖ –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–∞ 30 –¥–Ω–µ–π<br>
                            <strong>${PRICING.VERIFIED_30_DAYS}‚ÇΩ</strong>
                        </button>
                        <button class="btn-premium" onclick="selectPremiumType('URGENT_3_DAYS')" 
                                style="width: 100%; text-align: left; padding: 10px;">
                            üî• –°—Ä–æ—á–Ω–æ! –ù–∞ 3 –¥–Ω—è<br>
                            <strong>${PRICING.URGENT_3_DAYS}‚ÇΩ</strong>
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('paymentModal').style.display = 'flex';
            selectedPaymentMethod = null;
            document.getElementById('paymentInstructions').style.display = 'none';
            document.getElementById('payButton').disabled = true;
        }
        
        function selectPremiumType(type) {
            if (!currentPayment) return;
            
            currentPayment.type = type;
            currentPayment.price = PRICING[type];
            
            // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫–Ω–æ–ø–∫—É
            document.querySelectorAll('.btn-premium').forEach(btn => btn.style.opacity = '0.6');
            event.target.style.opacity = '1';
            event.target.style.border = '2px solid #ff6b00';
            
            document.getElementById('paymentInstructions').style.display = 'none';
            document.getElementById('payButton').disabled = true;
        }
        
        function selectPaymentMethod(method) {
            selectedPaymentMethod = method;
            
            // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –º–µ—Ç–æ–¥
            document.querySelectorAll('.payment-method').forEach(el => el.classList.remove('selected'));
            event.target.classList.add('selected');
            
            showPaymentInstructions();
            document.getElementById('payButton').disabled = false;
        }
        
        function showPaymentInstructions() {
            if (!currentPayment || !selectedPaymentMethod) return;
            
            let instructions = '';
            switch(selectedPaymentMethod) {
                case 'sber':
                    instructions = `
                        <h4>üí≥ –û–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ –°–±–µ—Ä–±–∞–Ω–∫ Online:</h4>
                        <ol style="margin: 10px 0; padding-left: 20px;">
                            <li>–û—Ç–∫—Ä–æ–π—Ç–µ <strong>–°–±–µ—Ä–±–∞–Ω–∫ Online</strong></li>
                            <li>–ü–µ—Ä–µ–≤–µ–¥–∏—Ç–µ <strong>${currentPayment.price}‚ÇΩ</strong> –Ω–∞ –Ω–æ–º–µ—Ä: <strong>+7-900-123-45-67</strong></li>
                            <li>–í –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ —É–∫–∞–∂–∏—Ç–µ: <code>${currentPayment.orderId}</code></li>
                            <li>–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç –ø–µ—Ä–µ–≤–æ–¥–∞</li>
                            <li>–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç –≤ Telegram: <strong>@spravochnik_pay</strong></li>
                        </ol>
                        <p style="background: #fff3cd; padding: 10px; border-radius: 5px; color: #856404;">
                            ‚ö†Ô∏è –ë–µ–∑ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞ –æ–ø–ª–∞—Ç–∞ –Ω–µ –±—É–¥–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞!
                        </p>
                    `;
                    break;
                    
                case 'tinkoff':
                    instructions = `
                        <h4>üì± –û–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ –¢–∏–Ω—å–∫–æ—Ñ—Ñ:</h4>
                        <div class="qr-code">
                            <div style="background: white; padding: 20px; display: inline-block; border: 2px dashed #ddd;">
                                [QR-–ö–û–î –î–õ–Ø –û–ü–õ–ê–¢–´ ${currentPayment.price}‚ÇΩ]
                            </div>
                            <p style="margin-top: 10px; font-size: 12px;">
                                –õ–∏–±–æ –ø–µ—Ä–µ–≤–µ–¥–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç—É: <strong>2200 1234 5678 9012</strong>
                            </p>
                        </div>
                        <p>–í –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ —É–∫–∞–∂–∏—Ç–µ: <code>${currentPayment.orderId}</code></p>
                    `;
                    break;
                    
                case 'cash':
                    instructions = `
                        <h4>üí∞ –û–ø–ª–∞—Ç–∞ –Ω–∞–ª–∏—á–Ω—ã–º–∏ –∫—É—Ä—å–µ—Ä—É:</h4>
                        <p>–ö—É—Ä—å–µ—Ä —Å–≤—è–∂–µ—Ç—Å—è —Å –≤–∞–º–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ <strong>24 —á–∞—Å–æ–≤</strong>.</p>
                        <p>–ü–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ <strong>${currentPayment.price}‚ÇΩ</strong> –Ω–∞–ª–∏—á–Ω—ã–º–∏.</p>
                        <p><strong>–ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞:</strong> <code>${currentPayment.orderId}</code></p>
                        <p><strong>–¢–µ–ª–µ—Ñ–æ–Ω –∫—É—Ä—å–µ—Ä–∞:</strong> 8-900-987-65-43</p>
                        <p style="background: #fff3cd; padding: 10px; border-radius: 5px; color: #856404;">
                            ‚ö†Ô∏è –°–æ–æ–±—â–∏—Ç–µ –∫—É—Ä—å–µ—Ä—É –Ω–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞!
                        </p>
                    `;
                    break;
            }
            
            document.getElementById('paymentInstructions').innerHTML = instructions;
            document.getElementById('paymentInstructions').style.display = 'block';
        }
        
        function processPayment() {
            if (!currentPayment || !currentPayment.type || !selectedPaymentMethod) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –ø—Ä–µ–º–∏—É–º–∞ –∏ —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã!');
                return;
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –ø–ª–∞—Ç—ë–∂ –≤ –∏—Å—Ç–æ—Ä–∏—é
            const payment = {
                ...currentPayment,
                method: selectedPaymentMethod,
                status: 'pending',
                timestamp: new Date().toISOString(),
                adminNote: ''
            };
            
            paymentsLog.unshift(payment);
            savePayments();
            
            alert(`‚úÖ –ó–∞–∫–∞–∑ #${payment.orderId} —Å–æ–∑–¥–∞–Ω!\n\n–°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –¥–ª—è –æ–ø–ª–∞—Ç—ã.\n–ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã —Å—Ç–∞—Ç—É—Å –±—É–¥–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º.`);
            
            closePaymentModal();
            if (adminMode) {
                renderPaymentsList();
                updatePaymentStats();
            }
        }
        
        function closePaymentModal() {
            document.getElementById('paymentModal').style.display = 'none';
            currentPayment = null;
            selectedPaymentMethod = null;
        }
        
        // ================ –ê–î–ú–ò–ù–ö–ê: –£–ü–†–ê–í–õ–ï–ù–ò–ï –ü–õ–ê–¢–ï–ñ–ê–ú–ò ================
        function renderPaymentsList() {
            const list = document.getElementById('paymentsList');
            if (!list) return;
            
            if (!paymentsLog.length) {
                list.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">–ü–ª–∞—Ç–µ–∂–µ–π –Ω–µ—Ç</div>';
                return;
            }
            
            list.innerHTML = paymentsLog.map(payment => `
                <div style="background: ${payment.status === 'completed' ? '#d4edda' : payment.status === 'cancelled' ? '#f8d7da' : '#fff3cd'}; 
                            border: 1px solid ${payment.status === 'completed' ? '#c3e6cb' : payment.status === 'cancelled' ? '#f5c6cb' : '#ffeaa7'};
                            border-radius: 8px; padding: 12px; margin-bottom: 8px;">
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <div style="flex: 1;">
                            <strong style="color: #2c3e50;">#${payment.orderId}</strong>
                            <div style="font-size: 12px; color: #666; margin-top: 4px;">
                                ${payment.serviceName}<br>
                                –¢–∏–ø: ${payment.type} | ${payment.price}‚ÇΩ<br>
                                –ú–µ—Ç–æ–¥: ${payment.method} | ${new Date(payment.timestamp).toLocaleString()}
                            </div>
                            ${payment.adminNote ? `<div style="margin-top: 5px; padding: 5px; background: white; border-radius: 4px; font-size: 11px;">${payment.adminNote}</div>` : ''}
                        </div>
                        <div style="display: flex; flex-direction: column; gap: 5px; margin-left: 10px;">
                            <span style="background: ${payment.status === 'completed' ? '#28a745' : payment.status === 'cancelled' ? '#dc3545' : '#ffc107'}; 
                                        color: white; padding: 3px 8px; border-radius: 12px; font-size: 11px; font-weight: bold;">
                                ${payment.status === 'completed' ? '‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω' : payment.status === 'cancelled' ? '‚ùå –û—Ç–º–µ–Ω—ë–Ω' : '‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ'}
                            </span>
                            ${payment.status === 'pending' ? `
                                <button class="btn btn-success" onclick="completePayment('${payment.orderId}')" style="padding: 4px 8px; font-size: 11px;">‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
                                <button class="btn btn-danger" onclick="cancelPayment('${payment.orderId}')" style="padding: 4px 8px; font-size: 11px;">‚ùå –û—Ç–º–µ–Ω–∏—Ç—å</button>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        function completePayment(orderId) {
            const payment = paymentsLog.find(p => p.orderId === orderId);
            if (!payment) return;
            
            if (confirm(`–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –æ–ø–ª–∞—Ç—É –∑–∞–∫–∞–∑–∞ #${orderId}?\n–£—Å–ª—É–≥–∞: ${payment.serviceName}\n–°—É–º–º–∞: ${payment.price}‚ÇΩ`)) {
                payment.status = 'completed';
                payment.completedAt = new Date().toISOString();
                
                // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –ø—Ä–µ–º–∏—É–º
                activatePremium(payment.serviceId, payment.type);
                
                savePayments();
                renderPaymentsList();
                updatePaymentStats();
                loadData(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —É—Å–ª—É–≥
                
                alert(`‚úÖ –ü–ª–∞—Ç—ë–∂ #${orderId} –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω!\n–ü—Ä–µ–º–∏—É–º-—Å—Ç–∞—Ç—É—Å –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω.`);
            }
        }
        
        function cancelPayment(orderId) {
            const payment = paymentsLog.find(p => p.orderId === orderId);
            if (!payment) return;
            
            const reason = prompt('–ü—Ä–∏—á–∏–Ω–∞ –æ—Ç–º–µ–Ω—ã –ø–ª–∞—Ç–µ–∂–∞:');
            if (reason === null) return;
            
            payment.status = 'cancelled';
            payment.adminNote = reason;
            payment.cancelledAt = new Date().toISOString();
            
            savePayments();
            renderPaymentsList();
            updatePaymentStats();
            
            alert(`‚ùå –ü–ª–∞—Ç—ë–∂ #${orderId} –æ—Ç–º–µ–Ω—ë–Ω.`);
        }
        
        function activatePremium(serviceId, type) {
            const service = data.find(s => s.id === serviceId);
            if (!service) return;
            
            const now = Date.now();
            let expires = now;
            
            switch(type) {
                case 'TOP_7_DAYS':
                case 'HIGHLIGHT_7_DAYS':
                    expires = now + 7 * 24 * 60 * 60 * 1000;
                    break;
                case 'VERIFIED_30_DAYS':
                    expires = now + 30 * 24 * 60 * 60 * 1000;
                    break;
                case 'URGENT_3_DAYS':
                    expires = now + 3 * 24 * 60 * 60 * 1000;
                    break;
            }
            
            if (!premiumServices[serviceId]) {
                premiumServices[serviceId] = {};
            }
            
            premiumServices[serviceId][type] = expires;
            savePremiumServices();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            filterListBy(currentCategoryForSearch, document.getElementById('categorySearchInput')?.value || '', 'categoryListContainer');
            filterListBy('all', document.getElementById('searchInput')?.value || '', 'mainListContainer');
        }
        
        function updatePaymentStats() {
            const stats = document.getElementById('paymentStats');
            if (!stats) return;
            
            const total = paymentsLog.length;
            const completed = paymentsLog.filter(p => p.status === 'completed').length;
            const pending = paymentsLog.filter(p => p.status === 'pending').length;
            const revenue = paymentsLog.filter(p => p.status === 'completed').reduce((sum, p) => sum + (p.price || 0), 0);
            
            stats.innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <div style="text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; color: #2c3e50;">${total}</div>
                        <div style="font-size: 12px; color: #666;">–í—Å–µ–≥–æ –ø–ª–∞—Ç–µ–∂–µ–π</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; color: #28a745;">${completed}</div>
                        <div style="font-size: 12px; color: #666;">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; color: #ffc107;">${pending}</div>
                        <div style="font-size: 12px; color: #666;">–û–∂–∏–¥–∞–Ω–∏–µ</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; color: #0066cc;">${revenue}‚ÇΩ</div>
                        <div style="font-size: 12px; color: #666;">–í—ã—Ä—É—á–∫–∞</div>
                    </div>
                </div>
            `;
        }
        
        function exportPaymentsToCSV() {
            const csv = [
                ['–ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞', '–£—Å–ª—É–≥–∞', '–¢–∏–ø', '–°—É–º–º–∞', '–ú–µ—Ç–æ–¥', '–°—Ç–∞—Ç—É—Å', '–î–∞—Ç–∞', '–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ'],
                ...paymentsLog.map(p => [
                    p.orderId,
                    p.serviceName,
                    p.type,
                    p.price + '‚ÇΩ',
                    p.method,
                    p.status,
                    new Date(p.timestamp).toLocaleString(),
                    p.adminNote || ''
                ])
            ].map(row => row.join(';')).join('\n');
            
            const blob = new Blob(['\uFEFF' + csv], {type: 'text/csv;charset=utf-8;'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `payments_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            alert('üìä CSV —Ñ–∞–π–ª —Å–∫–∞—á–∞–Ω!');
        }
        
        function clearCompletedPayments() {
            if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π?\n–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è.')) {
                paymentsLog = paymentsLog.filter(p => p.status !== 'completed');
                savePayments();
                renderPaymentsList();
                updatePaymentStats();
                alert('‚úÖ –ò—Å—Ç–æ—Ä–∏—è –æ—á–∏—â–µ–Ω–∞!');
            }
        }
        
        // ================ –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò (–∏–∑ —Ç–≤–æ–µ–≥–æ –∫–æ–¥–∞) ================
        // –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π, —Ç–æ–ª—å–∫–æ –¥–æ–±–∞–≤–ª—è–µ–º –ø—Ä–µ–º–∏—É–º-–∫–Ω–æ–ø–∫–∏
        
        function filterListBy(category, search, containerId){
            const container = document.getElementById(containerId);
            if (!container) return;

            let filtered = data.filter(item =>
                (adminMode || item.status === 'active') &&
                item.city.toLowerCase().includes(currentCity.toLowerCase()) &&
                (category === 'all' || item.category === category) &&
                (!search ||
                 item.name.toLowerCase().includes(search) ||
                 item.category.toLowerCase().includes(search) ||
                 item.description.toLowerCase().includes(search))
            );
            
            // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: –ø—Ä–µ–º–∏—É–º —É—Å–ª—É–≥–∏ –ø–µ—Ä–≤—ã–µ
            filtered.sort((a, b) => {
                const aPremium = Object.keys(premiumServices[a.id] || {}).some(type => isPremiumActive(a.id, type));
                const bPremium = Object.keys(premiumServices[b.id] || {}).some(type => isPremiumActive(b.id, type));
                
                if (aPremium && !bPremium) return -1;
                if (!aPremium && bPremium) return 1;
                
                // –ï—Å–ª–∏ –æ–±–∞ –ø—Ä–µ–º–∏—É–º –∏–ª–∏ –æ–±–∞ –Ω–µ –ø—Ä–µ–º–∏—É–º - —Å–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
                return new Date(b.addedAt || 0) - new Date(a.addedAt || 0);
            });

            if (!filtered.length) {
                container.innerHTML = '<div class="no-results">' +
                    (search ? '–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ' :
                     (containerId === 'mainListContainer' ? '' : '–ù–µ—Ç —É—Å–ª—É–≥ –≤ —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏')) +
                    '</div>';
                return;
            }

            container.innerHTML = filtered.map(item => {
                const parts = item.name.split(' ');
                const main = parts[0] || '';
                const sub = parts.slice(1).join(' ') || '';
                const phoneClean = item.phone.replace(/[^0-9]/g,'');
                const premiumClass = getPremiumClass(item.id);
                
                return `
                <div class="card ${premiumClass}">
                    <div class="card-content">
                        <div class="card-title-main">${main.toUpperCase()}</div>
                        ${sub ? `<div class="card-title-sub">${sub}</div>` : ''}
                        <div class="card-city">${'–≥.' + item.city.toUpperCase()}</div>
                        <div class="card-phone">—Ç.${item.phone}</div>
                        
                        <!-- –ö–ù–û–ü–ö–ò –ü–†–ï–ú–ò–£–ú–ê -->
                        ${isServiceOwner(item) ? `
                        <div style="margin-top: 10px; display: flex; gap: 5px; flex-wrap: wrap;">
                            ${!isPremiumActive(item.id, 'TOP_7_DAYS') ? `
                            <button class="btn-premium" onclick="showPremiumOptions('${item.id}', '${item.name}')" 
                                    style="background: linear-gradient(135deg,#ffd700,#ff9500);">
                                üöÄ –í —Ç–æ–ø (${PRICING.TOP_7_DAYS}‚ÇΩ)
                            </button>` : ''}
                            
                            ${!isPremiumActive(item.id, 'HIGHLIGHT_7_DAYS') ? `
                            <button class="btn-premium" onclick="showPremiumOptions('${item.id}', '${item.name}')"
                                    style="background: linear-gradient(135deg,#00b894,#00a085);">
                                üé® –í—ã–¥–µ–ª–∏—Ç—å (${PRICING.HIGHLIGHT_7_DAYS}‚ÇΩ)
                            </button>` : ''}
                            
                            ${!isPremiumActive(item.id, 'VERIFIED_30_DAYS') ? `
                            <button class="btn-premium" onclick="showPremiumOptions('${item.id}', '${item.name}')"
                                    style="background: linear-gradient(135deg,#0984e3,#6c5ce7);">
                                ‚úÖ –ì–∞–ª–æ—á–∫–∞ (${PRICING.VERIFIED_30_DAYS}‚ÇΩ)
                            </button>` : ''}
                            
                            ${!isPremiumActive(item.id, 'URGENT_3_DAYS') ? `
                            <button class="btn-premium" onclick="showPremiumOptions('${item.id}', '${item.name}')"
                                    style="background: linear-gradient(135deg,#e17055,#d63031);">
                                üî• –°—Ä–æ—á–Ω–æ! (${PRICING.URGENT_3_DAYS}‚ÇΩ)
                            </button>` : ''}
                        </div>
                        ` : ''}
                    </div>
                    <div class="card-actions">
                        ${item.site ? `<a href="${item.site}" target="_blank" class="btn-circle btn-site-circle"><span>üåê</span></a>` : ''}
                        <a href="tel:${phoneClean}" class="btn-circle btn-call-circle"><span>üìû</span></a>
                    </div>
                </div>`;
            }).join('');
        }
        
        function isServiceOwner(item) {
            // –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ - –≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –Ω—É–∂–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
            // –°–µ–π—á–∞—Å –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –≤—Å–µ–º, –Ω–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É
            return true; // –î–ª—è —Ç–µ—Å—Ç–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ–º
        }
        
        // –û—Å—Ç–∞–ª—å–Ω–æ–π —Ç–≤–æ–π –∫–æ–¥ –æ—Å—Ç–∞–µ—Ç—Å—è –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô –Ω–∏–∂–µ —ç—Ç–æ–π —Å—Ç—Ä–æ–∫–∏
        // –í–∫–ª—é—á–∞—è –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏: loadAdmins, loadCategories, renderCategoryButtons, 
        // renderCategorySelects, loadData, saveData, openCategory, showMainScreen, 
        // showProfileScreen, profileNext, openAdmin, checkAdmin, toggleAdminSection,
        // createAdminService, filterAdminList, renderAdminList, moveToTop, deleteItem,
        // loadFeedback, saveFeedback, showFeedbackScreen, sendFeedback, 
        // getVisibleFeedback, renderFeedbackForAdmin, loadAdminChat, saveAdminChat,
        // getVisibleChat, renderAdminChat, sendAdminChat, updateCitySuggestions,
        // chooseCity, startNext, goBackToStart, updateCityTitle, setupSearch
        
        // ================ –ù–ê–ß–ê–õ–û –û–†–ò–ì–ò–ù–ê–õ–¨–ù–û–ì–û –ö–û–î–ê ================
        /* ==== –ê–î–ú–ò–ù–´ ==== */
        function loadAdmins(){
            const saved = localStorage.getItem('ustKatavAdmins');
            if (saved){
                admins = JSON.parse(saved);
            } else {
                admins = [
                    {login:'super', pass:'1111', role:'super', city:'ALL'},
                    {login:'ust',   pass:'2222', role:'city',  city:'–£—Å—Ç—å-–ö–∞—Ç–∞–≤'}
                ];
                localStorage.setItem('ustKatavAdmins', JSON.stringify(admins));
            }
        }

        /* ==== –ö–ê–¢–ï–ì–û–†–ò–ò ==== */
        function loadCategories(){
            const saved = localStorage.getItem('ustKatavCategories');
            categories = saved ? JSON.parse(saved) : defaultCategories.slice();
            localStorage.setItem('ustKatavCategories', JSON.stringify(categories));
        }

        function saveCategories(){
            localStorage.setItem('ustKatavCategories', JSON.stringify(categories));
        }

        function renderCategoryButtons(){
            const wrap = document.getElementById('categoryButtons');
            wrap.innerHTML = categories.map(cat => `
                <button class="category-big" onclick="openCategory('${cat}')">
                    ${cat.toUpperCase()}
                </button>
            `).join('');
        }

        function renderCategorySelects(){
            const profSel = document.getElementById('profCategory');
            const adminSel = document.getElementById('adminCategory');

            const options = categories.map(cat => `<option value="${cat}">${cat}</option>`).join('');

            if (profSel){
                profSel.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>' + options;
            }
            if (adminSel){
                adminSel.innerHTML = '<option value="">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</option>' + options;
            }

            renderAdminCategoriesList();
        }

        function renderAdminCategoriesList(){
            const box = document.getElementById('adminCategoriesList');
            if(!box) return;

            if (!categories.length){
                box.innerHTML = '<div style="font-size:13px;color:#7f8c8d;">–ö–∞—Ç–µ–≥–æ—Ä–∏–π –Ω–µ—Ç</div>';
                return;
            }

            box.innerHTML = categories.map((cat, index) => `
                <div class="category-pill">
                    <span>${cat}</span>
                    <div style="display:flex; gap:4px;">
                        <button class="btn btn-success" style="padding:4px 8px;font-size:11px;"
                                onclick="renameCategory(${index})">‚úè –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å</button>
                        <button class="btn btn-danger" style="padding:4px 8px;font-size:11px;"
                                onclick="deleteCategory(${index})">üóë –£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                </div>
            `).join('');
        }

        function addCategory(){
            const input = document.getElementById('newCategoryName');
            const name = (input.value || '').trim();
            if(!name){
                alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏');
                return;
            }
            if (categories.includes(name)){
                alert('–¢–∞–∫–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è —É–∂–µ –µ—Å—Ç—å');
                return;
            }
            categories.push(name);
            saveCategories();
            input.value = '';
            renderCategoryButtons();
            renderCategorySelects();
        }

        function deleteCategory(index){
            const name = categories[index];
            if(!confirm(`–£–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é "${name}"?\n–£—Å–ª—É–≥–∏ –≤ —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –æ—Å—Ç–∞–Ω—É—Ç—Å—è, –Ω–æ –≤—ã–±–∏—Ä–∞—Ç—å –µ—ë –±—É–¥–µ—Ç –Ω–µ–ª—å–∑—è.`)){
                return;
            }
            categories.splice(index,1);
            saveCategories();
            renderCategoryButtons();
            renderCategorySelects();
        }

        function renameCategory(index){
            const oldName = categories[index];
            const newName = prompt('–ù–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:', oldName);
            if (newName === null) return;

            const trimmed = newName.trim();
            if (!trimmed){
                alert('–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º');
                return;
            }
            if (categories.includes(trimmed)){
                alert('–¢–∞–∫–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è —É–∂–µ –µ—Å—Ç—å');
                return;
            }

            categories[index] = trimmed;
            saveCategories();
            renderCategoryButtons();
            renderCategorySelects();

            data = data.map(item => {
                if (item.category === oldName){
                    return {...item, category: trimmed};
                }
                return item;
            });
            saveData();
            if (adminMode) renderAdminList();
        }

        /* ==== –ü–û–ò–°–ö ==== */
        function setupSearch() {
            document.getElementById('searchInput').addEventListener('input', function(){
                const search = this.value.toLowerCase();
                filterListBy('all', search, 'mainListContainer');
            });

            document.getElementById('categorySearchInput').addEventListener('input', function(){
                const search = this.value.toLowerCase();
                filterListBy(currentCategoryForSearch, search, 'categoryListContainer');
            });
        }

        function updateCityTitle() {
            document.getElementById('currentCityTitle').textContent = '–≥. ' + currentCity;
        }

        /* ==== –ì–û–†–û–î–ê –ù–ê –°–¢–ê–†–¢–ï ==== */
        function updateCitySuggestions() {
            const input = document.getElementById('startCityInput');
            const box = document.getElementById('citySuggestions');
            const value = input.value.trim().toLowerCase();

            if (!value) {
                box.style.display = 'none';
                box.innerHTML = '';
                return;
            }

            const filtered = cities.filter(c => c.toLowerCase().includes(value));
            if (!filtered.length) {
                box.style.display = 'none';
                box.innerHTML = '';
                return;
            }

            box.innerHTML = filtered.map(c => 
                `<div class="city-suggestion-item" onclick="chooseCity('${c}')">${c}</div>`
            ).join('');
            box.style.display = 'block';
        }

        function chooseCity(name) {
            document.getElementById('startCityInput').value = name;
            document.getElementById('citySuggestions').style.display = 'none';
        }

        function startNext() {
            const cityInput = document.getElementById('startCityInput').value.trim();
            currentCity = cityInput || '–£—Å—Ç—å-–ö–∞—Ç–∞–≤';
            updateCityTitle();
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('mainScreen').classList.add('active');
        }

        function goBackToStart() {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('startScreen').classList.add('active');
        }

        /* ==== –î–ê–ù–ù–´–ï –£–°–õ–£–ì ==== */
        function loadData() {
            const saved = localStorage.getItem('ustKatavData');
            data = saved ? JSON.parse(saved) : [
                {id: '1', name: "üöï –¢–∞–∫—Å–∏ –§–û–†–¢–£–ù–ê", category: "–¢–∞–∫—Å–∏", city: "–£—Å—Ç—å-–ö–∞—Ç–∞–≤", phone: "8-919-000-00-00", site: "", description: "–ö—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–æ–µ —Ç–∞–∫—Å–∏ –ø–æ –≥–æ—Ä–æ–¥—É –∏ —Ä–∞–π–æ–Ω—É", status: "active", expires: new Date().getTime() + 30*24*60*60*1000, addedAt: new Date().toISOString()},
                {id: '2', name: "üîß –°–∞–Ω—Ç–µ—Ö–Ω–∏–∫ –ê—Ä—Ç—ë–º", category: "–°–∞–Ω—Ç–µ—Ö–Ω–∏–∫", city: "–£—Å—Ç—å-–ö–∞—Ç–∞–≤", phone: "8-919-000-00-01", site: "", description: "–†–∞–±–æ—Ç–∞—é –≤ —Å–≤–æ–±–æ–¥–Ω–æ–µ –æ—Ç —Ä–∞–±–æ—Ç—ã –≤—Ä–µ–º—è", status: "active", expires: new Date().getTime() + 30*24*60*60*1000, addedAt: new Date().toISOString()},
                {id: '3', name: "‚ö° –≠–ª–µ–∫—Ç—Ä–∏–∫ –°–µ—Ä–≥–µ–π", category: "–≠–ª–µ–∫—Ç—Ä–∏–∫", city: "–£—Å—Ç—å-–ö–∞—Ç–∞–≤", phone: "8-919-000-00-02", site: "", description: "–ú–æ–Ω—Ç–∞–∂, —Ä–µ–º–æ–Ω—Ç, –≤—ã–µ–∑–¥", status: "active", expires: new Date().getTime() + 30*24*60*60*1000, addedAt: new Date().toISOString()},
                {id: '4', name: "üõí –ú—ë–¥ –æ—Ç –ê–Ω–¥—Ä–µ—è", category: "–¢–æ–≤–∞—Ä—ã –æ—Ç –º–µ—Å—Ç–Ω—ã—Ö", city: "–£—Å—Ç—å-–ö–∞—Ç–∞–≤", phone: "8-919-000-00-03", site: "https://vk.com/med_andreya", description: "–î–æ–º–∞—à–Ω–∏–π –º—ë–¥, –≤–æ–∑–º–æ–∂–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –≥–æ—Ä–æ–¥—É", status: "active", expires: new Date().getTime() + 30*24*60*60*1000, addedAt: new Date().toISOString()}
            ];
            
            // –î–æ–±–∞–≤–ª—è–µ–º ID –µ—Å–ª–∏ –Ω–µ—Ç
            data = data.map((item, index) => {
                if (!item.id) item.id = 'item_' + Date.now() + '_' + index;
                if (!item.addedAt) item.addedAt = new Date().toISOString();
                return item;
            });
            
            const now = new Date().getTime();
            data = data.map(item => {
                if (!item.status) item.status = 'active';
                if (item.expires && item.expires < now && item.status === 'active') item.status = 'expired';
                return item;
            });
            saveData();
            
            updateCityTitle();
            filterListBy('all','', 'mainListContainer');
        }

        function saveData(){ 
            // –î–æ–±–∞–≤–ª—è–µ–º ID –µ—Å–ª–∏ –Ω–µ—Ç
            data = data.map((item, index) => {
                if (!item.id) item.id = 'item_' + Date.now() + '_' + index;
                return item;
            });
            localStorage.setItem('ustKatavData', JSON.stringify(data)); 
        }

        function openCategory(cat){
            currentCategoryForSearch = cat;
            document.getElementById('categoryTitle').textContent = cat.toUpperCase();
            document.getElementById('categorySearchInput').value = '';
            document.getElementById('searchInput').value = '';

            filterListBy(cat, '', 'categoryListContainer');
            filterListBy(cat, '', 'mainListContainer');

            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('categoryScreen').classList.add('active');
        }

        function showMainScreen(){
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('mainScreen').classList.add('active');
            adminMode = false;
            currentAdmin = null;
            document.getElementById('searchInput').value = '';
            filterListBy('all', '', 'mainListContainer');
        }

        /* ==== –ü–†–û–§–ò–õ–¨ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø ==== */
        function showProfileScreen(){
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('profileScreen').classList.add('active');
            document.getElementById('profCity').value = currentCity;
        }

        function profileNext(){
            const name = document.getElementById('profName').value.trim();
            const category = document.getElementById('profCategory').value;
            const phone = document.getElementById('profPhone').value.trim();
            
            if(!name || !category || !phone){
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ, –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏ —Ç–µ–ª–µ—Ñ–æ–Ω');
                return;
            }
            
            const service = {
                id: 'service_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                name: name,
                category: category,
                city: document.getElementById('profCity').value.trim() || currentCity,
                phone: phone,
                site: document.getElementById('profSite').value.trim(),
                description: document.getElementById('profDescription').value.trim(),
                status: 'active',
                expires: new Date().getTime() + 30*24*60*60*1000,
                addedAt: new Date().toISOString()
            };
            
            data.unshift(service);
            saveData();
            showMainScreen();
            alert('‚úÖ –£—Å–ª—É–≥–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–∞ 30 –¥–Ω–µ–π!');
            
            document.getElementById('profName').value = '';
            document.getElementById('profCategory').value = '';
            document.getElementById('profCity').value = '';
            document.getElementById('profPhone').value = '';
            document.getElementById('profSite').value = '';
            document.getElementById('profDescription').value = '';
        }

        /* ==== –ê–î–ú–ò–ù–ö–ê ==== */
        function openAdmin(){
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('adminScreen').classList.add('active');
            document.getElementById('adminPassword').style.display = 'block';
            document.getElementById('adminContent').style.display = 'none';
        }

        function toggleAdminSection(key){
            const el = document.getElementById('adminSection-' + key);
            if (!el) return;
            el.classList.toggle('active');
        }

        function checkAdmin(){
            const login = document.getElementById('adminLogin').value.trim();
            const pass  = document.getElementById('adminPassInput').value.trim();
            loadAdmins();
            const found = admins.find(a => a.login === login && a.pass === pass);
            if (!found){
                alert('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å');
                return;
            }
            currentAdmin = found;
            adminMode = true;

            if (currentAdmin.role === 'city'){
                currentCity = currentAdmin.city;
                updateCityTitle();
            }

            document.getElementById('adminPassword').style.display = 'none';
            document.getElementById('adminContent').style.display = 'block';

            document.getElementById('adminCategoriesBlock').style.display =
                currentAdmin.role === 'super' ? 'block' : 'none';

            renderAdminCategoriesList();
            renderAdminList();
            renderFeedbackForAdmin();
            renderAdminChat();
            loadPayments();
            updatePaymentStats();
            
            document.getElementById('adminSearchInput').value = '';
            adminSearchTerm = '';
        }

        function filterAdminList() {
            const searchTerm = document.getElementById('adminSearchInput').value.toLowerCase();
            adminSearchTerm = searchTerm;
            renderAdminList();
        }

        function renderAdminList() {
            const adminList = document.getElementById('adminList');
            if(!data.length) {
                adminList.innerHTML = '<div style="text-align:center;padding:20px;color:#6c757d">–£—Å–ª—É–≥ –Ω–µ—Ç</div>';
                return;
            }
            
            const now = new Date().getTime();
            let visible = data;
            
            if (currentAdmin && currentAdmin.role === 'city') {
                visible = data.filter(item => item.city === currentAdmin.city);
            }
            
            if (adminSearchTerm) {
                visible = visible.filter(item =>
                    item.name.toLowerCase().includes(adminSearchTerm) ||
                    item.category.toLowerCase().includes(adminSearchTerm) ||
                    item.city.toLowerCase().includes(adminSearchTerm) ||
                    item.phone.includes(adminSearchTerm) ||
                    (item.description && item.description.toLowerCase().includes(adminSearchTerm))
                );
            }
            
            if (!visible.length) {
                adminList.innerHTML = '<div style="text-align:center;padding:20px;color:#6c757d">' + 
                                     (adminSearchTerm ? '–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ' : '–£—Å–ª—É–≥ –Ω–µ—Ç') + 
                                     '</div>';
                return;
            }
            
            adminList.innerHTML = visible.map(item => {
                const realIndex = data.indexOf(item);
                let statusText;
                if (item.expires === null) {
                    statusText = '‚àû (–∞–¥–º–∏–Ω)';
                } else {
                    const daysLeft = Math.ceil((item.expires - now) / (24*60*60*1000));
                    statusText = item.status === 'active' ? `${daysLeft} –¥–Ω.` : '–ò—Å—Ç—ë–∫';
                }
                
                return `
                <div class="admin-item">
                    <div style="display:flex; justify-content:space-between; align-items:start;">
                        <div style="flex:1">
                            <strong>${item.name}</strong><br>
                            <small>${item.category} | ${item.city} | ${item.phone}</small>
                            ${item.site ? '<br><small>üåê ' + item.site + '</small>' : ''}
                            ${item.description ? '<br><small>' + item.description + '</small>' : ''}
                            <br><span class="${item.status === 'active' ? 'status-active' : 'status-expired'}">${statusText}</span>
                        </div>
                        <div style="white-space:nowrap; margin-left:10px;">
                            <button class="btn btn-success" onclick="moveToTop(${realIndex})" 
                                    style="margin-bottom:4px;font-size:11px;padding:6px 10px">‚¨Ü –í —Ç–æ–ø</button><br>
                            <button class="btn btn-danger" onclick="deleteItem(${realIndex})" 
                                    style="font-size:11px;padding:6px 10px">üóë –£–¥–∞–ª–∏—Ç—å</button>
                        </div>
                    </div>
                </div>`;
            }).join('');
        }

        function createAdminService(){
            const name = document.getElementById('adminName').value.trim();
            const category = document.getElementById('adminCategory').value;
            const phone = document.getElementById('adminPhone').value.trim();
            
            if(!name || !category || !phone){
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è');
                return;
            }
            
            const days = parseInt(document.getElementById('adminDays').value);

            let cityValue = document.getElementById('adminCity').value.trim();
            if (currentAdmin && currentAdmin.role === 'city') cityValue = currentAdmin.city;

            const service = {
                id: 'admin_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                name: name,
                category: category,
                city: cityValue || currentCity,
                phone: phone,
                site: document.getElementById('adminSite').value.trim(),
                description: document.getElementById('adminDescription').value.trim(),
                status: 'active',
                expires: days === 0 ? null : new Date().getTime() + days*24*60*60*1000,
                addedAt: new Date().toISOString()
            };
            data.unshift(service);
            saveData();
            renderAdminList();
            alert(`‚úÖ –£—Å–ª—É–≥–∞ —Å–æ–∑–¥–∞–Ω–∞ –Ω–∞ ${days === 0 ? '–±–µ—Å—Ä–æ—á–Ω–æ' : days + ' –¥–Ω–µ–π'}!`);
            
            document.getElementById('adminName').value = '';
            document.getElementById('adminCategory').value = '';
            if (!currentAdmin || currentAdmin.role !== 'city') document.getElementById('adminCity').value = '';
            document.getElementById('adminPhone').value = '';
            document.getElementById('adminSite').value = '';
            document.getElementById('adminDescription').value = '';
            document.getElementById('adminDays').value = '30';
        }

        function moveToTop(i){
            const item = data[i];
            if (currentAdmin && currentAdmin.role === 'city' && item.city !== currentAdmin.city) {
                alert('–ù–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å–ª—É–≥ –¥—Ä—É–≥–∏—Ö –≥–æ—Ä–æ–¥–æ–≤');
                return;
            }
            data.splice(i, 1);
            data.unshift(item);
            saveData();
            renderAdminList();
            filterListBy('all', '', 'mainListContainer');
        }

        function deleteItem(i){
            const item = data[i];
            if (currentAdmin && currentAdmin.role === 'city' && item.city !== currentAdmin.city) {
                alert('–ù–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ —É—Å–ª—É–≥ –¥—Ä—É–≥–∏—Ö –≥–æ—Ä–æ–¥–æ–≤');
                return;
            }
            if(!confirm(`–£–¥–∞–ª–∏—Ç—å —É—Å–ª—É–≥—É "${item.name}"?`)) return;
            data.splice(i, 1);
            saveData();
            renderAdminList();
            filterListBy('all', '', 'mainListContainer');
        }

        /* ==== –û–ë–†–ê–¢–ù–ê–Ø –°–í–Ø–ó–¨ ==== */
        function loadFeedback() {
            const fb = localStorage.getItem('ustKatavFeedback');
            feedbackData = fb ? JSON.parse(fb) : [];
        }

        function saveFeedback() {
            localStorage.setItem('ustKatavFeedback', JSON.stringify(feedbackData));
        }

        function showFeedbackScreen() {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('feedbackScreen').classList.add('active');
        }

        function sendFeedback() {
            const text = document.getElementById('feedbackText').value.trim();
            const phone = document.getElementById('feedbackPhone').value.trim();
            if(!text) {
                alert('–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ');
                return;
            }
            feedbackData.unshift({
                id: Date.now(),
                text: text,
                phone: phone || '–Ω–µ —É–∫–∞–∑–∞–Ω',
                city: currentCity,
                date: new Date().toLocaleString('ru-RU')
            });
            saveFeedback();
            alert('‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!');
            showMainScreen();
            document.getElementById('feedbackText').value = '';
            document.getElementById('feedbackPhone').value = '';
            if (adminMode) renderFeedbackForAdmin();
        }

        function getVisibleFeedback() {
            if (currentAdmin && currentAdmin.role === 'super') return feedbackData;
            if (currentAdmin && currentAdmin.role === 'city') return feedbackData.filter(item => item.city === currentAdmin.city);
            return [];
        }

        function renderFeedbackForAdmin() {
            const box = document.getElementById('adminFeedbackList');
            if (!box) return;
            const items = getVisibleFeedback();
            if (!items.length) {
                box.innerHTML = '<div style="font-size:13px;color:#7f8c8d;">–°–æ–æ–±—â–µ–Ω–∏–π –Ω–µ—Ç</div>';
                return;
            }
            box.innerHTML = items.map(item => 
                `<div style="background:#fff;border-radius:8px;padding:8px 10px;margin-bottom:6px;font-size:13px">
                    <strong>${item.city}</strong> <small>${item.date}</small><br>
                    <small>üìû ${item.phone}</small><br>
                    <div>${item.text}</div>
                </div>`
            ).join('');
        }

        /* ==== –ß–ê–¢ –ê–î–ú–ò–ù–û–í ==== */
        function loadAdminChat() {
            const saved = localStorage.getItem('ustKatavAdminChat');
            adminChat = saved ? JSON.parse(saved) : [];
        }

        function saveAdminChat() {
            localStorage.setItem('ustKatavAdminChat', JSON.stringify(adminChat));
        }

        function getVisibleChat() {
            if (currentAdmin && currentAdmin.role === 'super') return adminChat;
            if (currentAdmin && currentAdmin.role === 'city') return adminChat.filter(m => m.city === 'ALL' || m.city === currentAdmin.city);
            return [];
        }

        function renderAdminChat() {
            const box = document.getElementById('adminChatMessages');
            if (!box) return;
            const items = getVisibleChat();
            if (!items.length) {
                box.innerHTML = '<div style="font-size:13px;color:#7f8c8d;">–°–æ–æ–±—â–µ–Ω–∏–π –Ω–µ—Ç</div>';
                return;
            }
            box.innerHTML = items.map(msg => 
                `<div style="background:#fff;border-radius:8px;padding:6px 8px;margin-bottom:4px;font-size:12px">
                    <strong>${msg.from}</strong> <small>${msg.city}</small> <small>${msg.time}</small><br>
                    <div>${msg.text}</div>
                </div>`
            ).join('');
        }

        function sendAdminChat() {
            if (!currentAdmin) {
                alert('–¢—Ä–µ–±—É–µ—Ç—Å—è –≤—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω–∫—É');
                return;
            }
            const input = document.getElementById('adminChatInput');
            const text = input.value.trim();
            if (!text) {
                alert('–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ');
                return;
            }
            adminChat.push({
                id: Date.now(),
                from: currentAdmin.login,
                city: currentAdmin.role === 'super' ? 'ALL' : currentAdmin.city,
                text: text,
                time: new Date().toLocaleString('ru-RU')
            });
            saveAdminChat();
            input.value = '';
            renderAdminChat();
        }
    </script>
</body>
</html>