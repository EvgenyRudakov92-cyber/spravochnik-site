<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ–ª–µ—Ñ–æ–Ω–Ω—ã–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫</title>
    <meta name="theme-color" content="#ff6b00">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #000; min-height: 100vh; }

        .container { max-width: 600px; margin: 0 auto; background: rgba(255,255,255,0.0); border-radius: 20px 20px 0 0; box-shadow: 0 20px 40px rgba(0,0,0,0.3); overflow: hidden; }

        .header { background: linear-gradient(135deg, #ff6b00, #b33939); color: white; padding: 16px 20px; text-align: center; position: relative; }
        .header h1 { font-size: 18px; margin-bottom: 4px; letter-spacing: 1px; }
        .header p { font-size: 12px; opacity: 0.9; }

        .back-btn {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            width: 44px;
            height: 44px;
            border-radius: 50%;
            border: 2px solid #ffffff;
            background: linear-gradient(135deg,#ff7a00,#ff3b00);
            color: #fff;
            font-size: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .search-box { padding: 16px 20px; background: transparent; }
        .search-input { width: 100%; padding: 10px 16px; font-size: 15px; border: 2px solid #e1e5e9; border-radius: 30px; outline: none; transition: all 0.3s; }
        .search-input:focus { border-color: #ff6b00; box-shadow: 0 0 0 3px rgba(255,107,0,0.15); }

        .list { padding: 0 12px 12px; max-height: 40vh; overflow-y: auto; background:transparent; }
        .no-results { text-align: center; padding: 20px 12px; color: #f1f2f6; font-size: 15px; }

        /* –ö–ê–†–¢–û–ß–ö–ê */
        .card {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #000000;
            border-radius: 30px;
            padding: 18px 20px;
            margin: 12px 0;
            box-shadow: 0 0 0 1px rgba(255,255,255,0.08),
                        0 16px 40px rgba(0,0,0,0.9);
            color: #ffffff;
            overflow: hidden;
        }
        .card::before {
            content: "";
            position: absolute;
            inset: -40%;
            background: radial-gradient(circle at center, rgba(255,120,0,0.9), transparent 60%);
            opacity: 0.8;
            z-index: 0;
        }
        .card-content {
            position: relative;
            z-index: 1;
            max-width: 65%;
        }
        .card-title-main {
            font-size: 22px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 4px;
        }
        .card-title-sub {
            font-size: 16px;
            font-weight: 500;
            font-style: italic;
            margin-bottom: 6px;
        }
        .card-city {
            font-size: 13px;
            letter-spacing: 1px;
            margin-bottom: 4px;
            opacity: 0.9;
        }
        .card-phone {
            font-size: 14px;
            font-weight: 700;
        }

        .card-actions {
            position: relative;
            z-index: 1;
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 12px;
        }
        .btn-circle {
            width: 72px;
            height: 72px;
            border-radius: 50%;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 26px rgba(0,0,0,0.8);
            cursor: pointer;
            transition: transform 0.15s ease, box-shadow 0.15s ease;
            text-decoration: none;
        }
        .btn-circle span {
            font-size: 34px;
            color: #ffffff;
        }
        .btn-call-circle {
            background: radial-gradient(circle at 30% 30%, #7fff5a, #00a826);
        }
        .btn-site-circle {
            background: radial-gradient(circle at 30% 30%, #7fd4ff, #005bb5);
        }
        .btn-circle:active {
            transform: scale(0.94);
            box-shadow: 0 6px 16px rgba(0,0,0,0.9);
        }

        /* –ö–ù–û–ü–ö–ò –í –°–¢–ò–õ–ï ¬´–î–ê–õ–ï–ï¬ª */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 10px 22px;
            border-radius: 25px;
            border: 2px solid #ffffff;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            text-decoration: none;
            background: linear-gradient(135deg,#ff7a00,#ff3b00);
            color: #ffffff;
            box-shadow: 0 6px 18px rgba(0,0,0,0.45);
            transition: transform 0.15s ease, box-shadow 0.15s ease, opacity 0.15s ease;
        }
        .btn:hover {
            box-shadow: 0 8px 22px rgba(0,0,0,0.6);
            transform: translateY(-1px);
        }
        .btn:active {
            transform: translateY(1px) scale(0.97);
            box-shadow: 0 3px 10px rgba(0,0,0,0.7);
        }
        .btn-primary,
        .btn-success,
        .btn-feedback {
            background: linear-gradient(135deg,#ff7a00,#ff3b00);
            color:#ffffff;
        }

        /* –†—è–¥ –∫–Ω–æ–ø–æ–∫ —Å–Ω–∏–∑—É */
        .buttons-row {
            display: flex;
            justify-content: space-between;
            gap: 8px;
        }
        .buttons-row .btn {
            flex: 1 1 0;
            padding: 10px 8px;
            font-size: 13px;
        }

        .btn-danger { background: #e17055; color: white; }
        .btn-danger:hover { background: #d63031; }

        .screen { display: none; }
        .screen.active { display: block; }

        #adminScreen input, #adminScreen textarea,
        #profileScreen input, #profileScreen textarea,
        #feedbackScreen textarea {
            width: 100%; padding: 10px; margin-bottom: 10px;
            border: 2px solid #e1e5e9; border-radius: 8px; font-size: 14px;
        }
        #adminScreen input:focus, #profileScreen input:focus, #feedbackScreen textarea:focus {
            border-color: #ff6b00; outline: none;
        }
        .admin-item { background: #f8f9fa; border-radius: 8px; padding: 10px; margin-bottom: 8px; font-size: 13px; }
        .status-active { color: #27ae60; font-weight: bold; }
        .status-expired { color: #e74c3c; font-weight: bold; }
        .days-select { background:#f8f9fa; padding:8px; border-radius:8px; margin-bottom:10px; font-size:13px; }
        .city-suggestions {
            position:absolute;
            top:100%;
            left:50%;
            transform:translateX(-50%);
            width:100%;
            max-width:420px;
            background:rgba(0,0,0,0.85);
            color:#fff;
            border-radius:8px;
            margin-top:6px;
            max-height:140px;
            overflow-y:auto;
            font-size:14px;
            z-index:3;
        }
        .city-suggestion-item{
            padding:8px 12px;
            border-bottom:1px solid rgba(255,255,255,0.1);
            cursor:pointer;
        }
        .city-suggestion-item:hover{
            background:rgba(255,255,255,0.08);
        }

        .category-big{
            width:100%;
            margin:6px 0;
            padding:10px 8px;
            border-radius:28px;
            border:2px solid #ffffff;
            background:linear-gradient(135deg,#000000,#ff7a00);
            color:#ffffff;
            font-size:18px;
            font-weight:800;
            text-align:center;
            cursor:pointer;
            box-shadow:0 6px 14px rgba(0,0,0,0.5);
        }
        .category-big:active{
            transform:scale(0.97);
        }

        .category-pill{
            display:flex;
            align-items:center;
            justify-content:space-between;
            padding:6px 10px;
            margin-bottom:6px;
            border-radius:16px;
            background:#f1f2f6;
            font-size:13px;
        }
        .category-pill span{
            flex:1;
        }

        /* –ê–∫–∫–æ—Ä–¥–µ–æ–Ω –≤ –∞–¥–º–∏–Ω–∫–µ */
        .admin-section { margin-bottom: 10px; }
        .admin-section-title {
            width:100%;
            text-align:left;
            padding:10px 12px;
            border-radius:10px;
            border:2px solid #ff7a00;
            background:linear-gradient(135deg,#000000,#ff7a00);
            color:#ffffff;
            font-size:14px;
            font-weight:700;
            cursor:pointer;
            margin-bottom:4px;
        }
        .admin-section-body {
            border-radius:10px;
            background:#f8f9fa;
            padding:10px;
            display:none;
        }
        .admin-section-body.active { display:block; }
    </style>
<script>
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤ –∏ —Å—Ç–∏–ª–µ–π
document.addEventListener('DOMContentLoaded', function() {
    // –î–ª—è –≤—Å–µ—Ö script —Ç–µ–≥–æ–≤
    document.querySelectorAll('script[src]').forEach(function(script) {
        var src = script.getAttribute('src');
        if (src.indexOf('?') === -1) { // –ï—Å–ª–∏ –Ω–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
            script.src = src + '?v=' + Date.now();
        }
    });
    
    // –î–ª—è –≤—Å–µ—Ö link[rel=stylesheet] —Ç–µ–≥–æ–≤
    document.querySelectorAll('link[rel="stylesheet"]').forEach(function(link) {
        var href = link.getAttribute('href');
        if (href && href.indexOf('?') === -1) {
            link.href = href + '?v=' + Date.now();
        }
    });
});
</script>
</head>
<body>

    <!-- –ü–ï–†–í–´–ô –≠–ö–†–ê–ù -->
    <div id="startScreen" class="screen active" style="max-width:600px;margin:0 auto;overflow:hidden;">
        <div style="
            position:relative;
            height:100vh;
            max-height:800px;
            background:#000;
            padding:20px 20px 100px 20px;
            display:flex;
            flex-direction:column;
            align-items:center;
        ">
            <div style="
                flex:1;
                width:100%;
                display:flex;
                flex-direction:column;
                align-items:center;
            ">
                <div style="
                    flex:1;
                    width:100%;
                    display:flex;
                    justify-content:center;
                    align-items:center;
                ">
                    <img src="IKONKA.png"
                         alt="–¢–µ–ª–µ—Ñ–æ–Ω–Ω—ã–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫"
                         style="width:70%; max-width:260px; border-radius:24px; box-shadow:0 10px 30px rgba(0,0,0,0.6);">
                </div>

                <div style="width:100%; max-width:420px; margin-bottom:40px; position:relative;">
                    <input id="startCityInput"
                           type="text"
                           placeholder="–ü–æ–∏—Å–∫ –ø–æ –≥–æ—Ä–æ–¥—É..."
                           autocomplete="off"
                           oninput="updateCitySuggestions()"
                           style="
                               width:100%;
                               padding:14px 18px;
                               border-radius:8px;
                               border:2px solid #ffffff;
                               background:rgba(0,0,0,0.75);
                               color:#ffffff;
                               font-size:16px;
                               outline:none;
                           ">
                    <div id="citySuggestions" class="city-suggestions" style="display:none;"></div>
                </div>
            </div>

            <button onclick="startNext()" 
                    style="
                        position:absolute;
                        bottom:40px;
                        right:40px;
                        padding:12px 30px;
                        border-radius:25px;
                        border:2px solid #ffffff;
                        background:linear-gradient(135deg,#ff7a00,#ff3b00);
                        color:#ffffff;
                        font-size:18px;
                        font-weight:bold;
                        cursor:pointer;
                        box-shadow:0 6px 18px rgba(0,0,0,0.4);
                    ">
                –î–∞–ª–µ–µ
            </button>
        </div>
    </div>

    <!-- –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ô–ù–ï–† -->
    <div class="container">

        <!-- –ì–õ–ê–í–ù–´–ô –≠–ö–†–ê–ù –° –ö–ê–¢–ï–ì–û–†–ò–Ø–ú–ò -->
        <div id="mainScreen" class="screen">
            <div class="header" style="background:linear-gradient(135deg,#ff7a00,#ff3b00);">
                <button class="back-btn" onclick="goBackToStart()">‚Üê</button>
                <h1 style="font-size:20px;">–¢–ï–õ–ï–§–û–ù–´</h1>
                <p id="currentCityTitle">–≥. –£—Å—Ç—å-–ö–∞—Ç–∞–≤</p>
            </div>

            <div style="
                background:#000;
                min-height:100vh;
                padding:16px 12px 24px;
            ">
                <div id="categoryButtons" style="max-height:50vh; overflow-y:auto; padding-right:4px;">
                    <!-- –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–∑ JS -->
                </div>

                <div style="margin-top:16px; background:rgba(0,0,0,0.7); padding:12px; border-radius:16px;">
                    <div class="search-box" style="padding:0 0 8px 0;">
                        <input type="text" id="searchInput" class="search-input" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É –≥–æ—Ä–æ–¥—É...">
                    </div>
                    <div class="list" id="mainListContainer"></div>
                    <div style="padding-top:10px;">
                        <div class="buttons-row">
                            <button class="btn btn-primary" onclick="showProfileScreen()">‚ûï –î–æ–±–∞–≤–∏—Ç—å —É—Å–ª—É–≥—É</button>
                            <button class="btn btn-success" onclick="openAdmin()">üõ† –ê–¥–º–∏–Ω</button>
                            <button class="btn btn-feedback" onclick="showFeedbackScreen()">üí¨ –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –≠–ö–†–ê–ù –ö–ê–¢–ï–ì–û–†–ò–ò -->
        <div id="categoryScreen" class="screen">
            <div class="header" style="background:linear-gradient(135deg,#ff7a00,#ff3b00);">
                <button class="back-btn" onclick="showMainScreen()">‚Üê</button>
                <h1 id="categoryTitle" style="font-size:20px;">–ö–ê–¢–ï–ì–û–†–ò–Ø</h1>
                <p>–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫</p>
            </div>

            <div style="
                background:#000;
                min-height:100vh;
                padding:16px 12px 24px;
            ">
                <div class="search-box" style="padding:0 0 16px;">
                    <input type="text" id="categorySearchInput" class="search-input" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏...">
                </div>
                <div class="list" id="categoryListContainer">
                    <div class="no-results">–ù–µ—Ç —É—Å–ª—É–≥ –≤ —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</div>
                </div>
            </div>
        </div>

        <!-- –î–û–ë–ê–í–õ–ï–ù–ò–ï –£–°–õ–£–ì–ò -->
        <div id="profileScreen" class="screen">
            <div class="header">
                <button class="back-btn" onclick="showMainScreen()">‚Üê</button>
                <h1>–î–æ–±–∞–≤–∏—Ç—å —É—Å–ª—É–≥—É</h1>
                <p>–ü—É–±–ª–∏–∫–∞—Ü–∏—è –Ω–∞ 30 –¥–Ω–µ–π</p>
            </div>
            <div style="padding: 20px; background:#fff;">
                <input type="text" id="profName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ (–≤–∞—à–µ –∏–º—è –∏–ª–∏ —Ñ–∏—Ä–º–∞)">
                <select id="profCategory" style="width:100%; padding:10px; margin-bottom:10px; border:2px solid #e1e5e9; border-radius:8px;">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                </select>
                <input type="text" id="profCity" placeholder="–ì–æ—Ä–æ–¥">
                <input type="tel" id="profPhone" placeholder="üìû –¢–µ–ª–µ—Ñ–æ–Ω (8-9xx-xxx-xx-xx)">
                <input type="url" id="profSite" placeholder="üåê –°–∞–π—Ç –∏–ª–∏ —Å–æ—Ü—Å–µ—Ç—å (https://...)">
                <textarea id="profDescription" rows="3" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ (–∫–æ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç–µ, –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏...)"></textarea>
                <button class="btn btn-primary" style="width:100%; padding:12px; font-size:15px;" onclick="profileNext()">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å (30 –¥–Ω–µ–π)</button>
            </div>
        </div>

        <!-- –ê–î–ú–ò–ù–ö–ê -->
        <div id="adminScreen" class="screen">
            <div class="header">
                <button class="back-btn" onclick="showMainScreen()">‚Üê</button>
                <h1>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h1>
                <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Å–ª—É–≥–∞–º–∏</p>
            </div>
            <div style="padding: 20px; background:#fff;">

                <!-- –í–•–û–î –ê–î–ú–ò–ù–ê -->
                <div id="adminPassword" style="text-align:center; padding:20px;">
                    <input type="text" id="adminLogin" placeholder="–õ–æ–≥–∏–Ω" style="width:200px; padding:10px; font-size:14px; text-align:center; margin-bottom:8px;"><br>
                    <input type="password" id="adminPassInput" placeholder="–ü–∞—Ä–æ–ª—å" style="width:200px; padding:10px; font-size:14px; text-align:center;"><br><br>
                    <button class="btn btn-primary" onclick="checkAdmin()">–í–æ–π—Ç–∏</button>
                </div>

                <div id="adminContent" style="display:none;">

                    <!-- –ü–ê–ü–ö–ê: –ö–ê–¢–ï–ì–û–†–ò–ò (–¢–û–õ–¨–ö–û –î–õ–Ø –°–£–ü–ï–†-–ê–î–ú–ò–ù–ê) -->
                    <div id="adminCategoriesBlock" class="admin-section">
                        <button class="admin-section-title" onclick="toggleAdminSection('cats')">üóÇ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏</button>
                        <div class="admin-section-body" id="adminSection-cats">
                            <div style="margin-bottom:8px;">
                                <input type="text" id="newCategoryName" placeholder="–ù–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è">
                                <button class="btn btn-success" style="width:100%; margin-top:6px;" onclick="addCategory()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</button>
                            </div>
                            <div id="adminCategoriesList" style="margin-bottom:4px;"></div>
                        </div>
                    </div>

                    <!-- –ü–ê–ü–ö–ê: –°–û–ó–î–ê–ù–ò–ï –£–°–õ–£–ì (–° –ü–û–ò–°–ö–û–ú) -->
                    <div class="admin-section">
                        <button class="admin-section-title" onclick="toggleAdminSection('services')">üìù –°–æ–∑–¥–∞–Ω–∏–µ —É—Å–ª—É–≥</button>
                        <div class="admin-section-body" id="adminSection-services">
                            <input type="text" id="adminName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
                            <select id="adminCategory" style="width:100%; padding:10px; margin-bottom:10px; border:2px solid #e1e5e9; border-radius:8px;">
                                <option value="">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</option>
                            </select>
                            <input type="text" id="adminCity" placeholder="–ì–æ—Ä–æ–¥">
                            <input type="tel" id="adminPhone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω">
                            <input type="url" id="adminSite" placeholder="–°–∞–π—Ç">
                            <textarea id="adminDescription" rows="2" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ"></textarea>

                            <div class="days-select">
                                <label style="display:block; margin-bottom:4px; font-weight:bold;">üìÖ –°—Ä–æ–∫ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏:</label>
                                <select id="adminDays" style="width:100%; padding:8px; border:2px solid #e1e5e9; border-radius:8px; font-size:14px;">
                                    <option value="7">7 –¥–Ω–µ–π (—Ç–µ—Å—Ç)</option>
                                    <option value="30" selected>30 –¥–Ω–µ–π (—Å—Ç–∞–Ω–¥–∞—Ä—Ç)</option>
                                    <option value="90">90 –¥–Ω–µ–π (3 –º–µ—Å—è—Ü–∞)</option>
                                    <option value="365">365 –¥–Ω–µ–π (–≥–æ–¥)</option>
                                    <option value="0">–ë–µ—Å—Å—Ä–æ—á–Ω–æ (–∞–¥–º–∏–Ω)</option>
                                </select>
                            </div>
                            <button class="btn btn-success" style="width:100%; margin-bottom:10px;" onclick="createAdminService()">‚ûï –°–æ–∑–¥–∞—Ç—å —É—Å–ª—É–≥—É</button>
                            
                            <!-- –ü–û–ò–°–ö –í –ê–î–ú–ò–ù–ö–ï -->
                            <div style="background:rgba(248,249,250,0.5); padding:12px; border-radius:8px; margin-bottom:10px;">
                                <input type="text" id="adminSearchInput" class="search-input" 
                                       placeholder="üîç –ü–æ–∏—Å–∫ —É—Å–ª—É–≥ (–∏–º—è, –∫–∞—Ç–µ–≥–æ—Ä–∏—è, –≥–æ—Ä–æ–¥, —Ç–µ–ª–µ—Ñ–æ–Ω, –æ–ø–∏—Å–∞–Ω–∏–µ...)" 
                                       style="width:100%; padding:10px 16px; font-size:14px; border:2px solid #e1e5e9; border-radius:20px;"
                                       oninput="filterAdminList()">
                            </div>
                            
                            <h3 style="margin-bottom:6px; color:#2c3e50; font-size:15px;">üìã –í—Å–µ —É—Å–ª—É–≥–∏</h3>
                            <div id="adminList" style="max-height:300px; overflow-y:auto;"></div>
                        </div>
                    </div>

                    <!-- –ü–ê–ü–ö–ê: –û–¢–ó–´–í–´/–ü–†–ï–î–õ–û–ñ–ï–ù–ò–Ø -->
                    <div class="admin-section">
                        <button class="admin-section-title" onclick="toggleAdminSection('feedback')">üì® –ñ–∞–ª–æ–±—ã –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è</button>
                        <div class="admin-section-body" id="adminSection-feedback">
                            <div id="adminFeedbackList"></div>
                        </div>
                    </div>

                    <!-- –ü–ê–ü–ö–ê: –ß–ê–¢ –ê–î–ú–ò–ù–û–í -->
                    <div class="admin-section">
                        <button class="admin-section-title" onclick="toggleAdminSection('chat')">üí¨ –ß–∞—Ç –∞–¥–º–∏–Ω–æ–≤</button>
                        <div class="admin-section-body" id="adminSection-chat">
                            <div id="adminChatMessages" style="max-height:200px; overflow-y:auto; margin-bottom:8px;"></div>
                            <textarea id="adminChatInput" rows="2" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –¥—Ä—É–≥–∏—Ö –∞–¥–º–∏–Ω–æ–≤..."></textarea>
                            <button class="btn btn-primary" style="width:100%;" onclick="sendAdminChat()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <!-- –û–ë–†–ê–¢–ù–ê–Ø –°–í–Ø–ó–¨ -->
        <div id="feedbackScreen" class="screen">
            <div class="header">
                <button class="back-btn" onclick="showMainScreen()">‚Üê</button>
                <h1>–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å</h1>
            </div>
            <div style="padding: 20px; background:#fff;">
                <textarea id="feedbackText" rows="5" placeholder="–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é –∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ..."></textarea>
                <input type="tel" id="feedbackPhone" placeholder="üìû –í–∞—à —Ç–µ–ª–µ—Ñ–æ–Ω (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)">
                <button class="btn btn-feedback" style="width:100%; padding:12px;" onclick="sendFeedback()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            </div>
        </div>

    </div>

    <script>
        let data = [];
        let currentCity = '–£—Å—Ç—å-–ö–∞—Ç–∞–≤';
        let adminMode = false;
        let feedbackData = [];
        let currentCategoryForSearch = 'all';
        let adminSearchTerm = ''; // –ù–û–í–û–ï: –ø–æ–∏—Å–∫ –≤ –∞–¥–º–∏–Ω–∫–µ

        // —Ä–æ–ª–∏ –∞–¥–º–∏–Ω–æ–≤
        let admins = [];
        let currentAdmin = null; // {login, role, city}

        // –º–∞—Å—Å–∏–≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
        let categories = [];

        const defaultCategories = [
            '–¢–∞–∫—Å–∏',
            '–°–∞–Ω—Ç–µ—Ö–Ω–∏–∫',
            '–≠–ª–µ–∫—Ç—Ä–∏–∫',
            '–ê—Ä—Ç–∏—Å—Ç—ã',
            '–ì—Ä—É–∑–æ–ø–µ—Ä–µ–≤–æ–∑–∫–∏',
            '–Æ—Ä–∏—Å—Ç',
            'IT —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç',
            '–ê–≤—Ç–æ—Ä–µ–º–æ–Ω—Ç',
            '–ü–∏–ª–æ—Ä–∞–º–∞',
            '–¢–æ–≤–∞—Ä—ã –æ—Ç –º–µ—Å—Ç–Ω—ã—Ö'
        ];

        const cities = [
            '–£—Å—Ç—å-–ö–∞—Ç–∞–≤','–Æ—Ä—é–∑–∞–Ω—å','–ö–∞—Ç–∞–≤-–ò–≤–∞–Ω–æ–≤—Å–∫','–¢—Ä—ë—Ö–≥–æ—Ä–Ω—ã–π','–ê—à–∞',
            '–°–∏–º','–ú–∏–∞—Å—Å','–ó–ª–∞—Ç–æ—É—Å—Ç','–ß–µ–ª—è–±–∏–Ω—Å–∫','–£—Ñ–∞','–ú–∞–≥–Ω–∏—Ç–æ–≥–æ—Ä—Å–∫','–ö—ã—à—Ç—ã–º'
        ];

        // —á–∞—Ç –∞–¥–º–∏–Ω–æ–≤
        let adminChat = [];

        document.addEventListener('DOMContentLoaded', function() {
            loadAdmins();
            loadCategories();
            renderCategoryButtons();
            renderCategorySelects();
            loadData();
            loadFeedback();
            loadAdminChat();
            setupSearch();
        });

        /* ==== –ê–î–ú–ò–ù–´ ==== */
        function loadAdmins(){
            const saved = localStorage.getItem('ustKatavAdmins');
            if (saved){
                admins = JSON.parse(saved);
            } else {
                admins = [
                    {login:'super', pass:'1111', role:'super', city:'ALL'},
                    {login:'ust',   pass:'2222', role:'city',  city:'–£—Å—Ç—å-–ö–∞—Ç–∞–≤'}
                ];
                localStorage.setItem('ustKatavAdmins', JSON.stringify(admins));
            }
        }

        /* ==== –ö–ê–¢–ï–ì–û–†–ò–ò ==== */
        function loadCategories(){
            const saved = localStorage.getItem('ustKatavCategories');
            categories = saved ? JSON.parse(saved) : defaultCategories.slice();
            localStorage.setItem('ustKatavCategories', JSON.stringify(categories));
        }

        function saveCategories(){
            localStorage.setItem('ustKatavCategories', JSON.stringify(categories));
        }

        function renderCategoryButtons(){
            const wrap = document.getElementById('categoryButtons');
            wrap.innerHTML = categories.map(cat => `
                <button class="category-big" onclick="openCategory('${cat}')">
                    ${cat.toUpperCase()}
                </button>
            `).join('');
        }

        function renderCategorySelects(){
            const profSel = document.getElementById('profCategory');
            const adminSel = document.getElementById('adminCategory');

            const options = categories.map(cat => `<option value="${cat}">${cat}</option>`).join('');

            if (profSel){
                profSel.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>' + options;
            }
            if (adminSel){
                adminSel.innerHTML = '<option value="">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</option>' + options;
            }

            renderAdminCategoriesList();
        }

        function renderAdminCategoriesList(){
            const box = document.getElementById('adminCategoriesList');
            if(!box) return;

            if (!categories.length){
                box.innerHTML = '<div style="font-size:13px;color:#7f8c8d;">–ö–∞—Ç–µ–≥–æ—Ä–∏–π –Ω–µ—Ç</div>';
                return;
            }

            box.innerHTML = categories.map((cat, index) => `
                <div class="category-pill">
                    <span>${cat}</span>
                    <div style="display:flex; gap:4px;">
                        <button class="btn btn-success" style="padding:4px 8px;font-size:11px;"
                                onclick="renameCategory(${index})">‚úè –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å</button>
                        <button class="btn btn-danger" style="padding:4px 8px;font-size:11px;"
                                onclick="deleteCategory(${index})">üóë –£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                </div>
            `).join('');
        }

        function addCategory(){
            const input = document.getElementById('newCategoryName');
            const name = (input.value || '').trim();
            if(!name){
                alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏');
                return;
            }
            if (categories.includes(name)){
                alert('–¢–∞–∫–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è —É–∂–µ –µ—Å—Ç—å');
                return;
            }
            categories.push(name);
            saveCategories();
            input.value = '';
            renderCategoryButtons();
            renderCategorySelects();
        }

        function deleteCategory(index){
            const name = categories[index];
            if(!confirm(`–£–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é "${name}"?\n–£—Å–ª—É–≥–∏ –≤ —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –æ—Å—Ç–∞–Ω—É—Ç—Å—è, –Ω–æ –≤—ã–±–∏—Ä–∞—Ç—å –µ—ë –±—É–¥–µ—Ç –Ω–µ–ª—å–∑—è.`)){
                return;
            }
            categories.splice(index,1);
            saveCategories();
            renderCategoryButtons();
            renderCategorySelects();
        }

        function renameCategory(index){
            const oldName = categories[index];
            const newName = prompt('–ù–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:', oldName);
            if (newName === null) return;

            const trimmed = newName.trim();
            if (!trimmed){
                alert('–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º');
                return;
            }
            if (categories.includes(trimmed)){
                alert('–¢–∞–∫–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è —É–∂–µ –µ—Å—Ç—å');
                return;
            }

            categories[index] = trimmed;
            saveCategories();
            renderCategoryButtons();
            renderCategorySelects();

            data = data.map(item => {
                if (item.category === oldName){
                    return {...item, category: trimmed};
                }
                return item;
            });
            saveData();
            if (adminMode) renderAdminList();
        }

        /* ==== –ü–û–ò–°–ö ==== */
        function setupSearch() {
            document.getElementById('searchInput').addEventListener('input', function(){
                const search = this.value.toLowerCase();
                filterListBy('all', search, 'mainListContainer');
            });

            document.getElementById('categorySearchInput').addEventListener('input', function(){
                const search = this.value.toLowerCase();
                filterListBy(currentCategoryForSearch, search, 'categoryListContainer');
            });
        }

        function updateCityTitle() {
            document.getElementById('currentCityTitle').textContent = '–£—Å–ª—É–≥–∏ –∏ —Ç–æ–≤–∞—Ä—ã: ' + currentCity;
        }

        /* ==== –ì–û–†–û–î–ê –ù–ê –°–¢–ê–†–¢–ï ==== */
        function updateCitySuggestions() {
            const input = document.getElementById('startCityInput');
            const box = document.getElementById('citySuggestions');
            const value = input.value.trim().toLowerCase();

            if (!value) {
                box.style.display = 'none';
                box.innerHTML = '';
                return;
            }

            const filtered = cities.filter(c => c.toLowerCase().includes(value));
            if (!filtered.length) {
                box.style.display = 'none';
                box.innerHTML = '';
                return;
            }

            box.innerHTML = filtered.map(c => 
                `<div class="city-suggestion-item" onclick="chooseCity('${c}')">${c}</div>`
            ).join('');
            box.style.display = 'block';
        }

        function chooseCity(name) {
            document.getElementById('startCityInput').value = name;
            document.getElementById('citySuggestions').style.display = 'none';
        }

        function startNext() {
            const cityInput = document.getElementById('startCityInput').value.trim();
            currentCity = cityInput || '–£—Å—Ç—å-–ö–∞—Ç–∞–≤';
            updateCityTitle();
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('mainScreen').classList.add('active');
        }

        function goBackToStart() {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('startScreen').classList.add('active');
        }

        /* ==== –î–ê–ù–ù–´–ï –£–°–õ–£–ì ==== */
        function loadData() {
            const saved = localStorage.getItem('ustKatavData');
            data = saved ? JSON.parse(saved) : [
                {name: "üöï –¢–∞–∫—Å–∏ –§–û–†–¢–£–ù–ê", category: "–¢–∞–∫—Å–∏", city: "–£—Å—Ç—å-–ö–∞—Ç–∞–≤", phone: "8-919-000-00-00", site: "", description: "–ö—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–æ–µ —Ç–∞–∫—Å–∏ –ø–æ –≥–æ—Ä–æ–¥—É –∏ —Ä–∞–π–æ–Ω—É", status: "active", expires: new Date().getTime() + 30*24*60*60*1000},
                {name: "üîß –°–∞–Ω—Ç–µ—Ö–Ω–∏–∫ –ê—Ä—Ç—ë–º", category: "–°–∞–Ω—Ç–µ—Ö–Ω–∏–∫", city: "–£—Å—Ç—å-–ö–∞—Ç–∞–≤", phone: "8-919-000-00-01", site: "", description: "–†–∞–±–æ—Ç–∞—é –≤ —Å–≤–æ–±–æ–¥–Ω–æ–µ –æ—Ç —Ä–∞–±–æ—Ç—ã –≤—Ä–µ–º—è", status: "active", expires: new Date().getTime() + 30*24*60*60*1000},
                {name: "‚ö° –≠–ª–µ–∫—Ç—Ä–∏–∫ –°–µ—Ä–≥–µ–π", category: "–≠–ª–µ–∫—Ç—Ä–∏–∫", city: "–£—Å—Ç—å-–ö–∞—Ç–∞–≤", phone: "8-919-000-00-02", site: "", description: "–ú–æ–Ω—Ç–∞–∂, —Ä–µ–º–æ–Ω—Ç, –≤—ã–µ–∑–¥", status: "active", expires: new Date().getTime() + 30*24*60*60*1000},
                {name: "üõí –ú—ë–¥ –æ—Ç –ê–Ω–¥—Ä–µ—è", category: "–¢–æ–≤–∞—Ä—ã –æ—Ç –º–µ—Å—Ç–Ω—ã—Ö", city: "–£—Å—Ç—å-–ö–∞—Ç–∞–≤", phone: "8-919-000-00-03", site: "https://vk.com/med_andreya", description: "–î–æ–º–∞—à–Ω–∏–π –º—ë–¥, –≤–æ–∑–º–æ–∂–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –≥–æ—Ä–æ–¥—É", status: "active", expires: new Date().getTime() + 30*24*60*60*1000}
            ];
            
            const now = new Date().getTime();
            data = data.map(item => {
                if (!item.status) item.status = 'active';
                if (item.expires && item.expires < now && item.status === 'active') item.status = 'expired';
                return item;
            });
            saveData();
            
            updateCityTitle();
            filterListBy('all','', 'mainListContainer');
        }

        function saveData(){ localStorage.setItem('ustKatavData', JSON.stringify(data)); }

        function filterListBy(category, search, containerId){
            const container = document.getElementById(containerId);

            let filtered = data.filter(item =>
                (adminMode || item.status === 'active') &&
                item.city.toLowerCase().includes(currentCity.toLowerCase()) &&
                (category === 'all' || item.category === category) &&
                (!search ||
                 item.name.toLowerCase().includes(search) ||
                 item.category.toLowerCase().includes(search) ||
                 item.description.toLowerCase().includes(search))
            );

            if (!filtered.length) {
                container.innerHTML = '<div class="no-results">' +
                    (search ? '–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ' :
                     (containerId === 'mainListContainer' ? '' : '–ù–µ—Ç —É—Å–ª—É–≥ –≤ —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏')) +
                    '</div>';
                return;
            }

            container.innerHTML = filtered.map(item => {
                const parts = item.name.split(' ');
                const main = parts[0] || '';
                const sub = parts.slice(1).join(' ') || '';
                const phoneClean = item.phone.replace(/[^0-9]/g,'');
                return `
                <div class="card">
                    <div class="card-content">
                        <div class="card-title-main">${main.toUpperCase()}</div>
                        ${sub ? `<div class="card-title-sub">${sub}</div>` : ''}
                        <div class="card-city">${'–≥.' + item.city.toUpperCase()}</div>
                        <div class="card-phone">—Ç.${item.phone}</div>
                    </div>
                    <div class="card-actions">
                        ${item.site ? `<a href="${item.site}" target="_blank" class="btn-circle btn-site-circle"><span>üåê</span></a>` : ''}
                        <a href="tel:${phoneClean}" class="btn-circle btn-call-circle"><span>üìû</span></a>
                    </div>
                </div>`;
            }).join('');
        }

        function openCategory(cat){
            currentCategoryForSearch = cat;
            document.getElementById('categoryTitle').textContent = cat.toUpperCase();
            document.getElementById('categorySearchInput').value = '';
            document.getElementById('searchInput').value = '';

            filterListBy(cat, '', 'categoryListContainer');
            filterListBy(cat, '', 'mainListContainer');

            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('categoryScreen').classList.add('active');
        }

        function showMainScreen(){
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('mainScreen').classList.add('active');
            adminMode = false;
            currentAdmin = null;
            document.getElementById('searchInput').value = '';
            filterListBy('all', '', 'mainListContainer');
        }

        /* ==== –ü–†–û–§–ò–õ–¨ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø ==== */
        function showProfileScreen(){
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('profileScreen').classList.add('active');
            document.getElementById('profCity').value = currentCity;
        }

        function profileNext(){
            const name = document.getElementById('profName').value.trim();
            const category = document.getElementById('profCategory').value;
            const phone = document.getElementById('profPhone').value.trim();
            
            if(!name || !category || !phone){
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ, –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏ —Ç–µ–ª–µ—Ñ–æ–Ω');
                return;
            }
            
            const service = {
                name: name,
                category: category,
                city: document.getElementById('profCity').value.trim() || currentCity,
                phone: phone,
                site: document.getElementById('profSite').value.trim(),
                description: document.getElementById('profDescription').value.trim(),
                status: 'active',
                expires: new Date().getTime() + 30*24*60*60*1000
            };
            
            data.unshift(service);
            saveData();
            showMainScreen();
            alert('‚úÖ –£—Å–ª—É–≥–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–∞ 30 –¥–Ω–µ–π!');
            
            document.getElementById('profName').value = '';
            document.getElementById('profCategory').value = '';
            document.getElementById('profCity').value = '';
            document.getElementById('profPhone').value = '';
            document.getElementById('profSite').value = '';
            document.getElementById('profDescription').value = '';
        }

        /* ==== –ê–î–ú–ò–ù–ö–ê ==== */
        function openAdmin(){
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('adminScreen').classList.add('active');
            document.getElementById('adminPassword').style.display = 'block';
            document.getElementById('adminContent').style.display = 'none';
        }

        function toggleAdminSection(key){
            const el = document.getElementById('adminSection-' + key);
            if (!el) return;
            el.classList.toggle('active');
        }

        function checkAdmin(){
            const login = document.getElementById('adminLogin').value.trim();
            const pass  = document.getElementById('adminPassInput').value.trim();
            loadAdmins();
            const found = admins.find(a => a.login === login && a.pass === pass);
            if (!found){
                alert('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å');
                return;
            }
            currentAdmin = found;
            adminMode = true;

            if (currentAdmin.role === 'city'){
                currentCity = currentAdmin.city;
                updateCityTitle();
            }

            document.getElementById('adminPassword').style.display = 'none';
            document.getElementById('adminContent').style.display = 'block';

            document.getElementById('adminCategoriesBlock').style.display =
                currentAdmin.role === 'super' ? 'block' : 'none';

            renderAdminCategoriesList();
            renderAdminList();
            renderFeedbackForAdmin();
            renderAdminChat();
            
            // –û–ß–ò–°–¢–ö–ê –ü–û–ò–°–ö–ê –ü–†–ò –í–•–û–î–ï
            document.getElementById('adminSearchInput').value = '';
            adminSearchTerm = '';
        }

        // –ù–û–í–´–ï –§–£–ù–ö–¶–ò–ò –ü–û–ò–°–ö–ê –í –ê–î–ú–ò–ù–ö–ï
        function filterAdminList() {
            const searchTerm = document.getElementById('adminSearchInput').value.toLowerCase();
            adminSearchTerm = searchTerm;
            renderAdminList();
        }

        function renderAdminList() {
            const adminList = document.getElementById('adminList');
            if(!data.length) {
                adminList.innerHTML = '<div style="text-align:center;padding:20px;color:#6c757d">–£—Å–ª—É–≥ –Ω–µ—Ç</div>';
                return;
            }
            
            const now = new Date().getTime();
            let visible = data;
            
            // –§–∏–ª—å—Ç—Ä –ø–æ –≥–æ—Ä–æ–¥—É –¥–ª—è city-–∞–¥–º–∏–Ω–∞
            if (currentAdmin && currentAdmin.role === 'city') {
                visible = data.filter(item => item.city === currentAdmin.city);
            }
            
            // –ü–û–ò–°–ö –ü–û –í–°–ï–ú –ü–û–õ–Ø–ú
            if (adminSearchTerm) {
                visible = visible.filter(item =>
                    item.name.toLowerCase().includes(adminSearchTerm) ||
                    item.category.toLowerCase().includes(adminSearchTerm) ||
                    item.city.toLowerCase().includes(adminSearchTerm) ||
                    item.phone.includes(adminSearchTerm) ||
                    (item.description && item.description.toLowerCase().includes(adminSearchTerm))
                );
            }
            
            if (!visible.length) {
                adminList.innerHTML = '<div style="text-align:center;padding:20px;color:#6c757d">' + 
                                     (adminSearchTerm ? '–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ' : '–£—Å–ª—É–≥ –Ω–µ—Ç') + 
                                     '</div>';
                return;
            }
            
            adminList.innerHTML = visible.map(item => {
                const realIndex = data.indexOf(item);
                let statusText;
                if (item.expires === null) {
                    statusText = '‚àû (–∞–¥–º–∏–Ω)';
                } else {
                    const daysLeft = Math.ceil((item.expires - now) / (24*60*60*1000));
                    statusText = item.status === 'active' ? `${daysLeft} –¥–Ω.` : '–ò—Å—Ç—ë–∫';
                }
                
                return `
                <div class="admin-item">
                    <div style="display:flex; justify-content:space-between; align-items:start;">
                        <div style="flex:1">
                            <strong>${item.name}</strong><br>
                            <small>${item.category} | ${item.city} | ${item.phone}</small>
                            ${item.site ? '<br><small>üåê ' + item.site + '</small>' : ''}
                            ${item.description ? '<br><small>' + item.description + '</small>' : ''}
                            <br><span class="${item.status === 'active' ? 'status-active' : 'status-expired'}">${statusText}</span>
                        </div>
                        <div style="white-space:nowrap; margin-left:10px;">
                            <button class="btn btn-success" onclick="moveToTop(${realIndex})" 
                                    style="margin-bottom:4px;font-size:11px;padding:6px 10px">‚¨Ü –í —Ç–æ–ø</button><br>
                            <button class="btn btn-danger" onclick="deleteItem(${realIndex})" 
                                    style="font-size:11px;padding:6px 10px">üóë –£–¥–∞–ª–∏—Ç—å</button>
                        </div>
                    </div>
                </div>`;
            }).join('');
        }

        function createAdminService(){
            const name = document.getElementById('adminName').value.trim();
            const category = document.getElementById('adminCategory').value;
            const phone = document.getElementById('adminPhone').value.trim();
            
            if(!name || !category || !phone){
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è');
                return;
            }
            
            const days = parseInt(document.getElementById('adminDays').value);

            let cityValue = document.getElementById('adminCity').value.trim();
            if (currentAdmin && currentAdmin.role === 'city') cityValue = currentAdmin.city;

            const service = {
                name: name,
                category: category,
                city: cityValue || currentCity,
                phone: phone,
                site: document.getElementById('adminSite').value.trim(),
                description: document.getElementById('adminDescription').value.trim(),
                status: 'active',
                expires: days === 0 ? null : new Date().getTime() + days*24*60*60*1000
            };
            data.unshift(service);
            saveData();
            renderAdminList();
            alert(`‚úÖ –£—Å–ª—É–≥–∞ —Å–æ–∑–¥–∞–Ω–∞ –Ω–∞ ${days === 0 ? '–±–µ—Å—Ä–æ—á–Ω–æ' : days + ' –¥–Ω–µ–π'}!`);
            
            document.getElementById('adminName').value = '';
            document.getElementById('adminCategory').value = '';
            if (!currentAdmin || currentAdmin.role !== 'city') document.getElementById('adminCity').value = '';
            document.getElementById('adminPhone').value = '';
            document.getElementById('adminSite').value = '';
            document.getElementById('adminDescription').value = '';
            document.getElementById('adminDays').value = '30';
        }

        function moveToTop(i){
            const item = data[i];
            if (currentAdmin && currentAdmin.role === 'city' && item.city !== currentAdmin.city) {
                alert('–ù–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å–ª—É–≥ –¥—Ä—É–≥–∏—Ö –≥–æ—Ä–æ–¥–æ–≤');
                return;
            }
            data.splice(i, 1);
            data.unshift(item);
            saveData();
            renderAdminList();
            filterListBy('all', '', 'mainListContainer');
        }

        function deleteItem(i){
            const item = data[i];
            if (currentAdmin && currentAdmin.role === 'city' && item.city !== currentAdmin.city) {
                alert('–ù–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ —É—Å–ª—É–≥ –¥—Ä—É–≥–∏—Ö –≥–æ—Ä–æ–¥–æ–≤');
                return;
            }
            if(!confirm(`–£–¥–∞–ª–∏—Ç—å —É—Å–ª—É–≥—É "${item.name}"?`)) return;
            data.splice(i, 1);
            saveData();
            renderAdminList();
            filterListBy('all', '', 'mainListContainer');
        }

        /* ==== –û–ë–†–ê–¢–ù–ê–Ø –°–í–Ø–ó–¨ ==== */
        function loadFeedback() {
            const fb = localStorage.getItem('ustKatavFeedback');
            feedbackData = fb ? JSON.parse(fb) : [];
        }

        function saveFeedback() {
            localStorage.setItem('ustKatavFeedback', JSON.stringify(feedbackData));
        }

        function showFeedbackScreen() {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('feedbackScreen').classList.add('active');
        }

        function sendFeedback() {
            const text = document.getElementById('feedbackText').value.trim();
            const phone = document.getElementById('feedbackPhone').value.trim();
            if(!text) {
                alert('–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ');
                return;
            }
            feedbackData.unshift({
                id: Date.now(),
                text: text,
                phone: phone || '–Ω–µ —É–∫–∞–∑–∞–Ω',
                city: currentCity,
                date: new Date().toLocaleString('ru-RU')
            });
            saveFeedback();
            alert('‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!');
            showMainScreen();
            document.getElementById('feedbackText').value = '';
            document.getElementById('feedbackPhone').value = '';
            if (adminMode) renderFeedbackForAdmin();
        }

        function getVisibleFeedback() {
            if (currentAdmin && currentAdmin.role === 'super') return feedbackData;
            if (currentAdmin && currentAdmin.role === 'city') return feedbackData.filter(item => item.city === currentAdmin.city);
            return [];
        }

        function renderFeedbackForAdmin() {
            const box = document.getElementById('adminFeedbackList');
            if (!box) return;
            const items = getVisibleFeedback();
            if (!items.length) {
                box.innerHTML = '<div style="font-size:13px;color:#7f8c8d;">–°–æ–æ–±—â–µ–Ω–∏–π –Ω–µ—Ç</div>';
                return;
            }
            box.innerHTML = items.map(item => 
                `<div style="background:#fff;border-radius:8px;padding:8px 10px;margin-bottom:6px;font-size:13px">
                    <strong>${item.city}</strong> <small>${item.date}</small><br>
                    <small>üìû ${item.phone}</small><br>
                    <div>${item.text}</div>
                </div>`
            ).join('');
        }

        /* ==== –ß–ê–¢ –ê–î–ú–ò–ù–û–í ==== */
        function loadAdminChat() {
            const saved = localStorage.getItem('ustKatavAdminChat');
            adminChat = saved ? JSON.parse(saved) : [];
        }

        function saveAdminChat() {
            localStorage.setItem('ustKatavAdminChat', JSON.stringify(adminChat));
        }

        function getVisibleChat() {
            if (currentAdmin && currentAdmin.role === 'super') return adminChat;
            if (currentAdmin && currentAdmin.role === 'city') return adminChat.filter(m => m.city === 'ALL' || m.city === currentAdmin.city);
            return [];
        }

        function renderAdminChat() {
            const box = document.getElementById('adminChatMessages');
            if (!box) return;
            const items = getVisibleChat();
            if (!items.length) {
                box.innerHTML = '<div style="font-size:13px;color:#7f8c8d;">–°–æ–æ–±—â–µ–Ω–∏–π –Ω–µ—Ç</div>';
                return;
            }
            box.innerHTML = items.map(msg => 
                `<div style="background:#fff;border-radius:8px;padding:6px 8px;margin-bottom:4px;font-size:12px">
                    <strong>${msg.from}</strong> <small>${msg.city}</small> <small>${msg.time}</small><br>
                    <div>${msg.text}</div>
                </div>`
            ).join('');
        }

        function sendAdminChat() {
            if (!currentAdmin) {
                alert('–¢—Ä–µ–±—É–µ—Ç—Å—è –≤—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω–∫—É');
                return;
            }
            const input = document.getElementById('adminChatInput');
            const text = input.value.trim();
            if (!text) {
                alert('–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ');
                return;
            }
            adminChat.push({
                id: Date.now(),
                from: currentAdmin.login,
                city: currentAdmin.role === 'super' ? 'ALL' : currentAdmin.city,
                text: text,
                time: new Date().toLocaleString('ru-RU')
            });
            saveAdminChat();
            input.value = '';
            renderAdminChat();
        }
    </script>
</body>
</html>
